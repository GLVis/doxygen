<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>GLVis: glvis.cpp Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body onload='searchBox.OnSelectItem(0);'>
<!-- Generated by Doxygen 1.7.4 -->
<script type="text/javascript"><!--
var searchBox = new SearchBox("searchBox", "search",false,'Search');
--></script>
<div id="top">
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">GLVis&#160;<span id="projectnumber">v1.2</span></div>
  </td>
 </tr>
 </tbody>
</table>
</div>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li id="searchli">
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
<div class="header">
  <div class="headertitle">
<div class="title">glvis.cpp</div>  </div>
</div>
<div class="contents">
<a href="glvis_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">// Copyright (c) 2010, Lawrence Livermore National Security, LLC. Produced at</span>
<a name="l00002"></a>00002 <span class="comment">// the Lawrence Livermore National Laboratory. LLNL-CODE-443271. All Rights</span>
<a name="l00003"></a>00003 <span class="comment">// reserved. See file COPYRIGHT for details.</span>
<a name="l00004"></a>00004 <span class="comment">//</span>
<a name="l00005"></a>00005 <span class="comment">// This file is part of the GLVis visualization tool and library. For more</span>
<a name="l00006"></a>00006 <span class="comment">// information and source code availability see http://glvis.googlecode.com.</span>
<a name="l00007"></a>00007 <span class="comment">//</span>
<a name="l00008"></a>00008 <span class="comment">// GLVis is free software; you can redistribute it and/or modify it under the</span>
<a name="l00009"></a>00009 <span class="comment">// terms of the GNU Lesser General Public License (as published by the Free</span>
<a name="l00010"></a>00010 <span class="comment">// Software Foundation) version 2.1 dated February 1999.</span>
<a name="l00011"></a>00011 
<a name="l00012"></a>00012 
<a name="l00013"></a>00013 <span class="comment">// GLVis - an OpenGL visualization server based on the MFEM library</span>
<a name="l00014"></a>00014 
<a name="l00015"></a>00015 
<a name="l00016"></a>00016 <span class="preprocessor">#include &lt;limits&gt;</span>
<a name="l00017"></a>00017 <span class="preprocessor">#include &lt;iostream&gt;</span>
<a name="l00018"></a>00018 <span class="preprocessor">#include &lt;fstream&gt;</span>
<a name="l00019"></a>00019 <span class="preprocessor">#include &lt;stdio.h&gt;</span>
<a name="l00020"></a>00020 <span class="preprocessor">#include &lt;string.h&gt;</span>
<a name="l00021"></a>00021 <span class="preprocessor">#include &lt;time.h&gt;</span>
<a name="l00022"></a>00022 
<a name="l00023"></a>00023 <span class="preprocessor">#include &quot;mfem.hpp&quot;</span>
<a name="l00024"></a>00024 <span class="preprocessor">#include &quot;<a class="code" href="visual_8hpp.html">lib/visual.hpp</a>&quot;</span>
<a name="l00025"></a>00025 
<a name="l00026"></a>00026 <span class="preprocessor">#include &lt;X11/keysym.h&gt;</span>
<a name="l00027"></a>00027 
<a name="l00028"></a>00028 <span class="preprocessor">#include &lt;unistd.h&gt;</span>
<a name="l00029"></a>00029 <span class="keyword">extern</span> <span class="keywordtype">char</span> ** <a class="code" href="glvis_8cpp.html#aa006daaf11f1e2e45a6ababaf463212b">environ</a>;
<a name="l00030"></a>00030 
<a name="l00031"></a>00031 <span class="keywordtype">void</span> <a class="code" href="glvis_8cpp.html#a99a4b7a7c6575486b93f03efc4a0100a">Set_Palette</a>(<span class="keywordtype">int</span>);
<a name="l00032"></a>00032 
<a name="l00033"></a><a class="code" href="glvis_8cpp.html#af7feceb354d564ca3e8fa1a2e3adee36">00033</a> <a class="code" href="classVisualizationSceneScalarData.html">VisualizationSceneScalarData</a> *<a class="code" href="glvis_8cpp.html#af7feceb354d564ca3e8fa1a2e3adee36">vs</a> = NULL;
<a name="l00034"></a>00034 
<a name="l00035"></a><a class="code" href="glvis_8cpp.html#a6a277a44276ae8eb3ddf57068db21ad4">00035</a> <span class="keywordtype">int</span> <a class="code" href="glvis_8cpp.html#a6a277a44276ae8eb3ddf57068db21ad4">portnum</a> = 19916, <a class="code" href="glvis_8cpp.html#adfab4eebf850cff6c1c1c4b8aa408293">input</a> = 1, <a class="code" href="glvis_8cpp.html#a928495140935d9d6ce0a100550473140">np</a> = 4;
<a name="l00036"></a><a class="code" href="glvis_8cpp.html#a8c44e7f0b97e72d22bb9ceb8dfa14a73">00036</a> <span class="keywordtype">char</span> <a class="code" href="glvis_8cpp.html#abea2b72c5af0af9d44259a6b5f0f168f">mesh_file</a>[128], <a class="code" href="glvis_8cpp.html#a8c44e7f0b97e72d22bb9ceb8dfa14a73">sol_file</a>[128], <a class="code" href="glvis_8cpp.html#a51ba742484f9bdff4502c62248f0ab5b">keys</a>[1000];
<a name="l00037"></a><a class="code" href="glvis_8cpp.html#a6e08f89b32254fb4b129720418e7c6ea">00037</a> Mesh * <a class="code" href="glvis_8cpp.html#a6e08f89b32254fb4b129720418e7c6ea">mesh</a> = NULL;
<a name="l00038"></a><a class="code" href="glvis_8cpp.html#ad1c82108bcbb85f7ee42a74277a45f8f">00038</a> Vector <a class="code" href="glvis_8cpp.html#abdff2ecf770abe7e9e10d3ac91efecc2">sol</a>, <a class="code" href="glvis_8cpp.html#ad5f3d37af3d7cf7c7bb37557d671277d">solu</a>, <a class="code" href="glvis_8cpp.html#a84f9b469e4c4f34f5ec4f988bf0462f6">solv</a>, <a class="code" href="glvis_8cpp.html#ad1c82108bcbb85f7ee42a74277a45f8f">solw</a>, *<a class="code" href="glvis_8cpp.html#a1014d99d63c917d8bc76907ed803be21">data</a>[3] = {NULL, NULL, NULL};
<a name="l00039"></a><a class="code" href="glvis_8cpp.html#a0714f6a875376bdae0e5afc025374521">00039</a> <span class="keywordtype">int</span> <a class="code" href="glvis_8cpp.html#a0714f6a875376bdae0e5afc025374521">is_gf</a> = 0, <a class="code" href="glvis_8cpp.html#acdd941cdcf1e0ea2f8232cf335455427">gf_component</a> = -1;
<a name="l00040"></a><a class="code" href="glvis_8cpp.html#a25f770a09ffb9eedb1bd5cea6429b871">00040</a> GridFunction *<a class="code" href="glvis_8cpp.html#a25f770a09ffb9eedb1bd5cea6429b871">grid_f</a> = NULL;
<a name="l00041"></a><a class="code" href="glvis_8cpp.html#a4b2065dfde212b686b1f4b5c2e176aae">00041</a> <span class="keywordtype">int</span> <a class="code" href="glvis_8cpp.html#a4b2065dfde212b686b1f4b5c2e176aae">mac</a> = 0;
<a name="l00042"></a><a class="code" href="glvis_8cpp.html#aa1b4446661b06b47fd9210f5c0790b6f">00042</a> <span class="keywordtype">int</span> <a class="code" href="glvis_8cpp.html#aa1b4446661b06b47fd9210f5c0790b6f">viscount</a> = 0;
<a name="l00043"></a><a class="code" href="glvis_8cpp.html#acff48e064c2a8bd9e14f5215c7af4042">00043</a> <span class="keywordtype">int</span> <a class="code" href="glvis_8cpp.html#acff48e064c2a8bd9e14f5215c7af4042">save_coloring</a> = 0;
<a name="l00044"></a>00044 
<a name="l00045"></a><a class="code" href="glvis_8cpp.html#a9ce11c4941669bb54ef502b68af07ec4">00045</a> <span class="keywordtype">int</span> <a class="code" href="glvis_8cpp.html#a9ce11c4941669bb54ef502b68af07ec4">window_x</a> = 0;
<a name="l00046"></a><a class="code" href="glvis_8cpp.html#a62627cc91e2bb07cf1033188a9863bfc">00046</a> <span class="keywordtype">int</span> <a class="code" href="glvis_8cpp.html#a62627cc91e2bb07cf1033188a9863bfc">window_y</a> = 0;
<a name="l00047"></a><a class="code" href="glvis_8cpp.html#a59f74fee0c8a623650109c9fb35d4fae">00047</a> <span class="keywordtype">int</span> <a class="code" href="glvis_8cpp.html#a59f74fee0c8a623650109c9fb35d4fae">window_w</a> = 400;
<a name="l00048"></a><a class="code" href="glvis_8cpp.html#a7b6ea03893fc7fb4126a3a0c2fb0c319">00048</a> <span class="keywordtype">int</span> <a class="code" href="glvis_8cpp.html#a7b6ea03893fc7fb4126a3a0c2fb0c319">window_h</a> = 350;
<a name="l00049"></a><a class="code" href="glvis_8cpp.html#a7adf363a6156576433840387057fbadc">00049</a> <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="glvis_8cpp.html#a7adf363a6156576433840387057fbadc">window_titles</a>[2] ={ <span class="stringliteral">&quot;GLVis [scalar data]&quot;</span>,
<a name="l00050"></a>00050                                 <span class="stringliteral">&quot;GLVis [vector data]&quot;</span> };
<a name="l00051"></a><a class="code" href="glvis_8cpp.html#ac2e15ab8707cf0b5252fea4a2b413de5">00051</a> istream *<a class="code" href="glvis_8cpp.html#ac2e15ab8707cf0b5252fea4a2b413de5">script</a> = NULL;
<a name="l00052"></a><a class="code" href="glvis_8cpp.html#af4af2b70781b30ab9adbc5050d80e996">00052</a> <span class="keywordtype">int</span> <a class="code" href="glvis_8cpp.html#af4af2b70781b30ab9adbc5050d80e996">scr_sol_autoscale</a> = 0;
<a name="l00053"></a><a class="code" href="glvis_8cpp.html#ac9a204cfe1cf4cf44eb62b5833fb7a59">00053</a> <span class="keywordtype">int</span> <a class="code" href="glvis_8cpp.html#ac9a204cfe1cf4cf44eb62b5833fb7a59">scr_running</a> = 0;
<a name="l00054"></a><a class="code" href="glvis_8cpp.html#abf425bbc686fbedef7e537b5a3743788">00054</a> <span class="keywordtype">int</span> <a class="code" href="glvis_8cpp.html#abf425bbc686fbedef7e537b5a3743788">scr_level</a> = 0;
<a name="l00055"></a><a class="code" href="glvis_8cpp.html#a6541d4ec47f9c1b3cd475b2e1ed73262">00055</a> Vector *<a class="code" href="glvis_8cpp.html#a6541d4ec47f9c1b3cd475b2e1ed73262">init_nodes</a> = NULL;
<a name="l00056"></a><a class="code" href="glvis_8cpp.html#a595e4cfb0d88ad5063879cfd71fee1d3">00056</a> <span class="keywordtype">double</span> <a class="code" href="glvis_8cpp.html#a595e4cfb0d88ad5063879cfd71fee1d3">scr_min_val</a>, <a class="code" href="glvis_8cpp.html#af3b4b81d02c5ed6da83ef0f3a3c62669">scr_max_val</a>;
<a name="l00057"></a>00057 
<a name="l00058"></a>00058 <span class="comment">// read the mesh and the solution from a file</span>
<a name="l00059"></a>00059 <span class="keywordtype">void</span> <a class="code" href="glvis_8cpp.html#ae95873a146942467b3b5334fb87ae1c7">ReadSerial</a>();
<a name="l00060"></a>00060 
<a name="l00061"></a>00061 <span class="comment">// read the mesh and the solution from multiple files</span>
<a name="l00062"></a>00062 <span class="keywordtype">void</span> <a class="code" href="glvis_8cpp.html#ab6dbf6bd93cd8e385c10e3b8613a0685">ReadParallel</a>();
<a name="l00063"></a>00063 
<a name="l00064"></a><a class="code" href="glvis_8cpp.html#ab318e333a53a4c136b8008ebf482b8b8">00064</a> <span class="keywordtype">int</span> <a class="code" href="glvis_8cpp.html#ab318e333a53a4c136b8008ebf482b8b8">InitVis</a>(<span class="keywordtype">int</span> t)
<a name="l00065"></a>00065 {
<a name="l00066"></a>00066    <span class="keywordflow">return</span> <a class="code" href="aux__vis_8cpp.html#a1cb02c2636dea48ecf59bab2c8d3be5c" title="Initializes the visualization and some keys.">InitVisualization</a>(<a class="code" href="glvis_8cpp.html#a7adf363a6156576433840387057fbadc">window_titles</a>[t], <a class="code" href="glvis_8cpp.html#a9ce11c4941669bb54ef502b68af07ec4">window_x</a>, <a class="code" href="glvis_8cpp.html#a62627cc91e2bb07cf1033188a9863bfc">window_y</a>,
<a name="l00067"></a>00067                             <a class="code" href="glvis_8cpp.html#a59f74fee0c8a623650109c9fb35d4fae">window_w</a>, <a class="code" href="glvis_8cpp.html#a7b6ea03893fc7fb4126a3a0c2fb0c319">window_h</a>);
<a name="l00068"></a>00068 }
<a name="l00069"></a>00069 
<a name="l00070"></a>00070 <span class="comment">// Visualize the content of a string stream (e.g. from socket/file)</span>
<a name="l00071"></a><a class="code" href="glvis_8cpp.html#af94f1bc876c02a9c075cd150a676fbd9">00071</a> <span class="keywordtype">void</span> <a class="code" href="glvis_8cpp.html#af94f1bc876c02a9c075cd150a676fbd9">VisStream</a>(istream * iss, <span class="keywordtype">char</span> * data_type)
<a name="l00072"></a>00072 {
<a name="l00073"></a>00073    <span class="keywordtype">int</span> window_err = 0;
<a name="l00074"></a>00074 
<a name="l00075"></a>00075    <span class="keywordflow">if</span> (strcmp(data_type,<span class="stringliteral">&quot;fem2d_data&quot;</span>) == 0)
<a name="l00076"></a>00076    {
<a name="l00077"></a>00077       window_err = <a class="code" href="glvis_8cpp.html#ab318e333a53a4c136b8008ebf482b8b8">InitVis</a>(0);
<a name="l00078"></a>00078       <span class="keywordflow">if</span> (!window_err)
<a name="l00079"></a>00079       {
<a name="l00080"></a>00080          <a class="code" href="glvis_8cpp.html#a6e08f89b32254fb4b129720418e7c6ea">mesh</a> = <span class="keyword">new</span> Mesh(*iss, 0, 0);
<a name="l00081"></a>00081          <a class="code" href="glvis_8cpp.html#abdff2ecf770abe7e9e10d3ac91efecc2">sol</a>.Load(*iss, <a class="code" href="glvis_8cpp.html#a6e08f89b32254fb4b129720418e7c6ea">mesh</a>-&gt;GetNV());
<a name="l00082"></a>00082 
<a name="l00083"></a>00083          vs = <span class="keyword">new</span> <a class="code" href="classVisualizationSceneSolution.html">VisualizationSceneSolution</a>(*<a class="code" href="glvis_8cpp.html#a6e08f89b32254fb4b129720418e7c6ea">mesh</a>, <a class="code" href="glvis_8cpp.html#abdff2ecf770abe7e9e10d3ac91efecc2">sol</a>);
<a name="l00084"></a>00084       }
<a name="l00085"></a>00085    }
<a name="l00086"></a>00086    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(data_type,<span class="stringliteral">&quot;vfem2d_data&quot;</span>) == 0 ||
<a name="l00087"></a>00087             strcmp(data_type,<span class="stringliteral">&quot;vfem2d_data_keys&quot;</span>) == 0 )
<a name="l00088"></a>00088    {
<a name="l00089"></a>00089       window_err = <a class="code" href="glvis_8cpp.html#ab318e333a53a4c136b8008ebf482b8b8">InitVis</a>(1);
<a name="l00090"></a>00090       <span class="keywordflow">if</span> (!window_err)
<a name="l00091"></a>00091       {
<a name="l00092"></a>00092          <a class="code" href="glvis_8cpp.html#a6e08f89b32254fb4b129720418e7c6ea">mesh</a> = <span class="keyword">new</span> Mesh(*iss, 0, 0);
<a name="l00093"></a>00093          <a class="code" href="glvis_8cpp.html#ad5f3d37af3d7cf7c7bb37557d671277d">solu</a>.Load(*iss, <a class="code" href="glvis_8cpp.html#a6e08f89b32254fb4b129720418e7c6ea">mesh</a>-&gt;GetNV());
<a name="l00094"></a>00094          <a class="code" href="glvis_8cpp.html#a84f9b469e4c4f34f5ec4f988bf0462f6">solv</a>.Load(*iss, <a class="code" href="glvis_8cpp.html#a6e08f89b32254fb4b129720418e7c6ea">mesh</a>-&gt;GetNV());
<a name="l00095"></a>00095 
<a name="l00096"></a>00096          vs = <span class="keyword">new</span> <a class="code" href="classVisualizationSceneVector.html">VisualizationSceneVector</a>(*<a class="code" href="glvis_8cpp.html#a6e08f89b32254fb4b129720418e7c6ea">mesh</a>, <a class="code" href="glvis_8cpp.html#ad5f3d37af3d7cf7c7bb37557d671277d">solu</a>, <a class="code" href="glvis_8cpp.html#a84f9b469e4c4f34f5ec4f988bf0462f6">solv</a>);
<a name="l00097"></a>00097 
<a name="l00098"></a>00098          <span class="keywordflow">if</span> (strcmp(data_type,<span class="stringliteral">&quot;vfem2d_data_keys&quot;</span>) == 0)
<a name="l00099"></a>00099             *iss &gt;&gt; <a class="code" href="glvis_8cpp.html#a51ba742484f9bdff4502c62248f0ab5b">keys</a>;
<a name="l00100"></a>00100       }
<a name="l00101"></a>00101    }
<a name="l00102"></a>00102    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(data_type,<span class="stringliteral">&quot;fem3d_data&quot;</span>) == 0)
<a name="l00103"></a>00103    {
<a name="l00104"></a>00104       window_err = <a class="code" href="glvis_8cpp.html#ab318e333a53a4c136b8008ebf482b8b8">InitVis</a>(0);
<a name="l00105"></a>00105       <span class="keywordflow">if</span> (!window_err)
<a name="l00106"></a>00106       {
<a name="l00107"></a>00107          <a class="code" href="glvis_8cpp.html#a6e08f89b32254fb4b129720418e7c6ea">mesh</a> = <span class="keyword">new</span> Mesh(*iss, 0, 0);
<a name="l00108"></a>00108          <a class="code" href="glvis_8cpp.html#abdff2ecf770abe7e9e10d3ac91efecc2">sol</a>.Load(*iss, <a class="code" href="glvis_8cpp.html#a6e08f89b32254fb4b129720418e7c6ea">mesh</a>-&gt;GetNV());
<a name="l00109"></a>00109 
<a name="l00110"></a>00110          vs = <span class="keyword">new</span> <a class="code" href="classVisualizationSceneSolution3d.html">VisualizationSceneSolution3d</a>(*<a class="code" href="glvis_8cpp.html#a6e08f89b32254fb4b129720418e7c6ea">mesh</a>, <a class="code" href="glvis_8cpp.html#abdff2ecf770abe7e9e10d3ac91efecc2">sol</a>);
<a name="l00111"></a>00111       }
<a name="l00112"></a>00112    }
<a name="l00113"></a>00113    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(data_type,<span class="stringliteral">&quot;vfem3d_data&quot;</span>) == 0 ||
<a name="l00114"></a>00114             strcmp(data_type,<span class="stringliteral">&quot;vfem3d_data_keys&quot;</span>) == 0 )
<a name="l00115"></a>00115    {
<a name="l00116"></a>00116       window_err = <a class="code" href="glvis_8cpp.html#ab318e333a53a4c136b8008ebf482b8b8">InitVis</a>(1);
<a name="l00117"></a>00117       <span class="keywordflow">if</span> (!window_err)
<a name="l00118"></a>00118       {
<a name="l00119"></a>00119          <a class="code" href="glvis_8cpp.html#a6e08f89b32254fb4b129720418e7c6ea">mesh</a> = <span class="keyword">new</span> Mesh(*iss, 0, 0);
<a name="l00120"></a>00120          <a class="code" href="glvis_8cpp.html#ad5f3d37af3d7cf7c7bb37557d671277d">solu</a>.Load(*iss, <a class="code" href="glvis_8cpp.html#a6e08f89b32254fb4b129720418e7c6ea">mesh</a>-&gt;GetNV());
<a name="l00121"></a>00121          <a class="code" href="glvis_8cpp.html#a84f9b469e4c4f34f5ec4f988bf0462f6">solv</a>.Load(*iss, <a class="code" href="glvis_8cpp.html#a6e08f89b32254fb4b129720418e7c6ea">mesh</a>-&gt;GetNV());
<a name="l00122"></a>00122          <a class="code" href="glvis_8cpp.html#ad1c82108bcbb85f7ee42a74277a45f8f">solw</a>.Load(*iss, <a class="code" href="glvis_8cpp.html#a6e08f89b32254fb4b129720418e7c6ea">mesh</a>-&gt;GetNV());
<a name="l00123"></a>00123 
<a name="l00124"></a>00124          vs = <span class="keyword">new</span> <a class="code" href="classVisualizationSceneVector3d.html">VisualizationSceneVector3d</a>(*<a class="code" href="glvis_8cpp.html#a6e08f89b32254fb4b129720418e7c6ea">mesh</a>, <a class="code" href="glvis_8cpp.html#ad5f3d37af3d7cf7c7bb37557d671277d">solu</a>, <a class="code" href="glvis_8cpp.html#a84f9b469e4c4f34f5ec4f988bf0462f6">solv</a>, <a class="code" href="glvis_8cpp.html#ad1c82108bcbb85f7ee42a74277a45f8f">solw</a>);
<a name="l00125"></a>00125 
<a name="l00126"></a>00126          <span class="keywordflow">if</span> (strcmp(data_type,<span class="stringliteral">&quot;vfem3d_data_keys&quot;</span>) == 0)
<a name="l00127"></a>00127             *iss &gt;&gt; <a class="code" href="glvis_8cpp.html#a51ba742484f9bdff4502c62248f0ab5b">keys</a>;
<a name="l00128"></a>00128       }
<a name="l00129"></a>00129    }
<a name="l00130"></a>00130    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(data_type,<span class="stringliteral">&quot;fem3d_paragrid&quot;</span>) == 0)
<a name="l00131"></a>00131    {
<a name="l00132"></a>00132       window_err = <a class="code" href="glvis_8cpp.html#ab318e333a53a4c136b8008ebf482b8b8">InitVis</a>(0);
<a name="l00133"></a>00133       <span class="keywordflow">if</span> (!window_err)
<a name="l00134"></a>00134          vs = <span class="keyword">new</span> <a class="code" href="classVisualizationSceneSolution3d.html">VisualizationSceneSolution3d</a>(*<a class="code" href="glvis_8cpp.html#a6e08f89b32254fb4b129720418e7c6ea">mesh</a>, *<a class="code" href="glvis_8cpp.html#a1014d99d63c917d8bc76907ed803be21">data</a>[0]);
<a name="l00135"></a>00135    }
<a name="l00136"></a>00136    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(data_type,<span class="stringliteral">&quot;vfem3d_paragrid&quot;</span>) == 0)
<a name="l00137"></a>00137    {
<a name="l00138"></a>00138       window_err = <a class="code" href="glvis_8cpp.html#ab318e333a53a4c136b8008ebf482b8b8">InitVis</a>(1);
<a name="l00139"></a>00139       <span class="keywordflow">if</span> (!window_err)
<a name="l00140"></a>00140          vs = <span class="keyword">new</span> <a class="code" href="classVisualizationSceneVector3d.html">VisualizationSceneVector3d</a>(*<a class="code" href="glvis_8cpp.html#a6e08f89b32254fb4b129720418e7c6ea">mesh</a>, *<a class="code" href="glvis_8cpp.html#a1014d99d63c917d8bc76907ed803be21">data</a>[0],
<a name="l00141"></a>00141                                              *<a class="code" href="glvis_8cpp.html#a1014d99d63c917d8bc76907ed803be21">data</a>[1], *<a class="code" href="glvis_8cpp.html#a1014d99d63c917d8bc76907ed803be21">data</a>[2]);
<a name="l00142"></a>00142    }
<a name="l00143"></a>00143    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(data_type,<span class="stringliteral">&quot;fem2d_gf_data&quot;</span>) == 0 ||
<a name="l00144"></a>00144             strcmp(data_type,<span class="stringliteral">&quot;fem2d_gf_data_keys&quot;</span>) == 0)
<a name="l00145"></a>00145    {
<a name="l00146"></a>00146       window_err = <a class="code" href="glvis_8cpp.html#ab318e333a53a4c136b8008ebf482b8b8">InitVis</a>(0);
<a name="l00147"></a>00147       <span class="keywordflow">if</span> (!window_err)
<a name="l00148"></a>00148       {
<a name="l00149"></a>00149          <a class="code" href="glvis_8cpp.html#a6e08f89b32254fb4b129720418e7c6ea">mesh</a> = <span class="keyword">new</span> Mesh(*iss, 1, 0);
<a name="l00150"></a>00150          *iss &gt;&gt; ws;
<a name="l00151"></a>00151          <a class="code" href="glvis_8cpp.html#a25f770a09ffb9eedb1bd5cea6429b871">grid_f</a> = <span class="keyword">new</span> GridFunction (<a class="code" href="glvis_8cpp.html#a6e08f89b32254fb4b129720418e7c6ea">mesh</a>, *iss);
<a name="l00152"></a>00152          <a class="code" href="glvis_8cpp.html#a25f770a09ffb9eedb1bd5cea6429b871">grid_f</a> -&gt; GetNodalValues (<a class="code" href="glvis_8cpp.html#abdff2ecf770abe7e9e10d3ac91efecc2">sol</a>);
<a name="l00153"></a>00153          <a class="code" href="classVisualizationSceneSolution.html">VisualizationSceneSolution</a> *vss;
<a name="l00154"></a>00154          vs = vss = <span class="keyword">new</span> <a class="code" href="classVisualizationSceneSolution.html">VisualizationSceneSolution</a>(*<a class="code" href="glvis_8cpp.html#a6e08f89b32254fb4b129720418e7c6ea">mesh</a>, <a class="code" href="glvis_8cpp.html#abdff2ecf770abe7e9e10d3ac91efecc2">sol</a>);
<a name="l00155"></a>00155          vss -&gt; SetGridFunction (*<a class="code" href="glvis_8cpp.html#a25f770a09ffb9eedb1bd5cea6429b871">grid_f</a>);
<a name="l00156"></a>00156          <span class="keywordflow">if</span> (strcmp(data_type,<span class="stringliteral">&quot;fem2d_gf_data_keys&quot;</span>) == 0)
<a name="l00157"></a>00157             *iss &gt;&gt; <a class="code" href="glvis_8cpp.html#a51ba742484f9bdff4502c62248f0ab5b">keys</a>;
<a name="l00158"></a>00158       }
<a name="l00159"></a>00159    }
<a name="l00160"></a>00160    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(data_type,<span class="stringliteral">&quot;vfem2d_gf_data&quot;</span>) == 0 ||
<a name="l00161"></a>00161             strcmp(data_type,<span class="stringliteral">&quot;vfem2d_gf_data_keys&quot;</span>) == 0 )
<a name="l00162"></a>00162    {
<a name="l00163"></a>00163       window_err = <a class="code" href="glvis_8cpp.html#ab318e333a53a4c136b8008ebf482b8b8">InitVis</a>(1);
<a name="l00164"></a>00164       <span class="keywordflow">if</span> (!window_err)
<a name="l00165"></a>00165       {
<a name="l00166"></a>00166          <a class="code" href="glvis_8cpp.html#a6e08f89b32254fb4b129720418e7c6ea">mesh</a> = <span class="keyword">new</span> Mesh(*iss, 1, 0);
<a name="l00167"></a>00167          *iss &gt;&gt; ws;
<a name="l00168"></a>00168          <a class="code" href="glvis_8cpp.html#a25f770a09ffb9eedb1bd5cea6429b871">grid_f</a> = <span class="keyword">new</span> GridFunction (<a class="code" href="glvis_8cpp.html#a6e08f89b32254fb4b129720418e7c6ea">mesh</a>, *iss);
<a name="l00169"></a>00169          vs = <span class="keyword">new</span> <a class="code" href="classVisualizationSceneVector.html">VisualizationSceneVector</a> (*<a class="code" href="glvis_8cpp.html#a25f770a09ffb9eedb1bd5cea6429b871">grid_f</a>);
<a name="l00170"></a>00170          <span class="keywordflow">if</span> (strcmp(data_type,<span class="stringliteral">&quot;vfem2d_gf_data_keys&quot;</span>) == 0)
<a name="l00171"></a>00171             *iss &gt;&gt; <a class="code" href="glvis_8cpp.html#a51ba742484f9bdff4502c62248f0ab5b">keys</a>;
<a name="l00172"></a>00172       }
<a name="l00173"></a>00173    }
<a name="l00174"></a>00174    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(data_type,<span class="stringliteral">&quot;fem3d_gf_data&quot;</span>) == 0 ||
<a name="l00175"></a>00175             strcmp(data_type,<span class="stringliteral">&quot;fem3d_gf_data_keys&quot;</span>) == 0)
<a name="l00176"></a>00176    {
<a name="l00177"></a>00177       window_err = <a class="code" href="glvis_8cpp.html#ab318e333a53a4c136b8008ebf482b8b8">InitVis</a>(0);
<a name="l00178"></a>00178       <span class="keywordflow">if</span> (!window_err)
<a name="l00179"></a>00179       {
<a name="l00180"></a>00180          <a class="code" href="glvis_8cpp.html#a6e08f89b32254fb4b129720418e7c6ea">mesh</a> = <span class="keyword">new</span> Mesh(*iss, 1, 0);
<a name="l00181"></a>00181          *iss &gt;&gt; ws;
<a name="l00182"></a>00182          <a class="code" href="glvis_8cpp.html#a25f770a09ffb9eedb1bd5cea6429b871">grid_f</a> = <span class="keyword">new</span> GridFunction (<a class="code" href="glvis_8cpp.html#a6e08f89b32254fb4b129720418e7c6ea">mesh</a>, *iss);
<a name="l00183"></a>00183          <a class="code" href="glvis_8cpp.html#a25f770a09ffb9eedb1bd5cea6429b871">grid_f</a> -&gt; GetNodalValues (<a class="code" href="glvis_8cpp.html#abdff2ecf770abe7e9e10d3ac91efecc2">sol</a>);
<a name="l00184"></a>00184          <a class="code" href="classVisualizationSceneSolution3d.html">VisualizationSceneSolution3d</a> *vss;
<a name="l00185"></a>00185          vs = vss = <span class="keyword">new</span> <a class="code" href="classVisualizationSceneSolution3d.html">VisualizationSceneSolution3d</a>(*<a class="code" href="glvis_8cpp.html#a6e08f89b32254fb4b129720418e7c6ea">mesh</a>, <a class="code" href="glvis_8cpp.html#abdff2ecf770abe7e9e10d3ac91efecc2">sol</a>);
<a name="l00186"></a>00186          vss -&gt; SetGridFunction (<a class="code" href="glvis_8cpp.html#a25f770a09ffb9eedb1bd5cea6429b871">grid_f</a>);
<a name="l00187"></a>00187          <span class="keywordflow">if</span> (strcmp(data_type,<span class="stringliteral">&quot;fem3d_gf_data_keys&quot;</span>) == 0)
<a name="l00188"></a>00188             *iss &gt;&gt; <a class="code" href="glvis_8cpp.html#a51ba742484f9bdff4502c62248f0ab5b">keys</a>;
<a name="l00189"></a>00189       }
<a name="l00190"></a>00190    }
<a name="l00191"></a>00191    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(data_type,<span class="stringliteral">&quot;vfem3d_gf_data&quot;</span>) == 0 ||
<a name="l00192"></a>00192             strcmp(data_type,<span class="stringliteral">&quot;vfem3d_gf_data_keys&quot;</span>) == 0)
<a name="l00193"></a>00193    {
<a name="l00194"></a>00194       window_err = <a class="code" href="glvis_8cpp.html#ab318e333a53a4c136b8008ebf482b8b8">InitVis</a>(1);
<a name="l00195"></a>00195       <span class="keywordflow">if</span> (!window_err)
<a name="l00196"></a>00196       {
<a name="l00197"></a>00197          <a class="code" href="glvis_8cpp.html#a6e08f89b32254fb4b129720418e7c6ea">mesh</a> = <span class="keyword">new</span> Mesh(*iss, 1, 0);
<a name="l00198"></a>00198          *iss &gt;&gt; ws;
<a name="l00199"></a>00199          <a class="code" href="glvis_8cpp.html#a25f770a09ffb9eedb1bd5cea6429b871">grid_f</a> = <span class="keyword">new</span> GridFunction (<a class="code" href="glvis_8cpp.html#a6e08f89b32254fb4b129720418e7c6ea">mesh</a>, *iss);
<a name="l00200"></a>00200          vs = <span class="keyword">new</span> <a class="code" href="classVisualizationSceneVector3d.html">VisualizationSceneVector3d</a> (*<a class="code" href="glvis_8cpp.html#a25f770a09ffb9eedb1bd5cea6429b871">grid_f</a>);
<a name="l00201"></a>00201          <span class="keywordflow">if</span> (strcmp(data_type,<span class="stringliteral">&quot;vfem3d_gf_data_keys&quot;</span>) == 0)
<a name="l00202"></a>00202             *iss &gt;&gt; <a class="code" href="glvis_8cpp.html#a51ba742484f9bdff4502c62248f0ab5b">keys</a>;
<a name="l00203"></a>00203       }
<a name="l00204"></a>00204    }
<a name="l00205"></a>00205    <span class="keywordflow">else</span>
<a name="l00206"></a>00206    {
<a name="l00207"></a>00207       cerr &lt;&lt; <span class="stringliteral">&quot;Unknown data format&quot;</span> &lt;&lt; endl;
<a name="l00208"></a>00208       cerr &lt;&lt; data_type &lt;&lt; endl;
<a name="l00209"></a>00209       <span class="keywordflow">return</span>;
<a name="l00210"></a>00210    }
<a name="l00211"></a>00211    <span class="keywordflow">if</span> (!window_err)
<a name="l00212"></a>00212    {
<a name="l00213"></a>00213       <a class="code" href="aux__vis_8cpp.html#a123d870a20286e4b2092338cb960e782" title="Start the infinite visualization loop.">SetVisualizationScene</a> (vs, 3, <a class="code" href="glvis_8cpp.html#a51ba742484f9bdff4502c62248f0ab5b">keys</a>);
<a name="l00214"></a>00214       <a class="code" href="aux__vis_8cpp.html#a0b4b010980b49b61990ed57786b88092">KillVisualization</a>(); <span class="comment">// deletes vs</span>
<a name="l00215"></a>00215       vs = NULL;
<a name="l00216"></a>00216       <span class="keyword">delete</span> <a class="code" href="glvis_8cpp.html#a25f770a09ffb9eedb1bd5cea6429b871">grid_f</a>; <a class="code" href="glvis_8cpp.html#a25f770a09ffb9eedb1bd5cea6429b871">grid_f</a> = NULL;
<a name="l00217"></a>00217       <span class="keyword">delete</span> <a class="code" href="glvis_8cpp.html#a6e08f89b32254fb4b129720418e7c6ea">mesh</a>; <a class="code" href="glvis_8cpp.html#a6e08f89b32254fb4b129720418e7c6ea">mesh</a> = NULL;
<a name="l00218"></a>00218    }
<a name="l00219"></a>00219    <span class="keywordflow">else</span>
<a name="l00220"></a>00220    {
<a name="l00221"></a>00221       cerr &lt;&lt; <span class="stringliteral">&quot;Initializing the visualization failed.&quot;</span> &lt;&lt; endl;
<a name="l00222"></a>00222    }
<a name="l00223"></a>00223 }
<a name="l00224"></a>00224 
<a name="l00225"></a><a class="code" href="glvis_8cpp.html#a7338b117485f5eb4d304888a33049e31">00225</a> <span class="keywordtype">int</span> <a class="code" href="glvis_8cpp.html#a7338b117485f5eb4d304888a33049e31">ScriptReadSolution</a>(istream &amp;scr, Mesh **mp, GridFunction **sp)
<a name="l00226"></a>00226 {
<a name="l00227"></a>00227    <span class="keywordtype">string</span> word;
<a name="l00228"></a>00228 
<a name="l00229"></a>00229    cout &lt;&lt; <span class="stringliteral">&quot;Script: solution: &quot;</span> &lt;&lt; flush;
<a name="l00230"></a>00230    <span class="comment">// read the mesh</span>
<a name="l00231"></a>00231    scr &gt;&gt; ws &gt;&gt; word; <span class="comment">// mesh filename (can&#39;t contain spaces)</span>
<a name="l00232"></a>00232    {
<a name="l00233"></a>00233       ifstream imesh(word.c_str());
<a name="l00234"></a>00234       <span class="keywordflow">if</span> (!imesh)
<a name="l00235"></a>00235       {
<a name="l00236"></a>00236          cout &lt;&lt; <span class="stringliteral">&quot;Can not open mesh file: &quot;</span> &lt;&lt; word &lt;&lt; endl;
<a name="l00237"></a>00237          <span class="keywordflow">return</span> 1;
<a name="l00238"></a>00238       }
<a name="l00239"></a>00239       *mp = <span class="keyword">new</span> Mesh(imesh, 1, 0);
<a name="l00240"></a>00240       cout &lt;&lt; <span class="stringliteral">&quot;mesh: &quot;</span> &lt;&lt; word &lt;&lt; <span class="stringliteral">&quot;; &quot;</span> &lt;&lt; flush;
<a name="l00241"></a>00241    }
<a name="l00242"></a>00242 
<a name="l00243"></a>00243    <span class="comment">// read the solution (GridFunction)</span>
<a name="l00244"></a>00244    scr &gt;&gt; ws &gt;&gt; word;
<a name="l00245"></a>00245    {
<a name="l00246"></a>00246       ifstream isol(word.c_str());
<a name="l00247"></a>00247       <span class="keywordflow">if</span> (!isol)
<a name="l00248"></a>00248       {
<a name="l00249"></a>00249          cout &lt;&lt; <span class="stringliteral">&quot;Can not open solution file: &quot;</span> &lt;&lt; word &lt;&lt; endl;
<a name="l00250"></a>00250          <span class="keyword">delete</span> *mp; *mp = NULL;
<a name="l00251"></a>00251          <span class="keywordflow">return</span> 2;
<a name="l00252"></a>00252       }
<a name="l00253"></a>00253       *sp = <span class="keyword">new</span> GridFunction(*mp, isol);
<a name="l00254"></a>00254       cout &lt;&lt; <span class="stringliteral">&quot;solution: &quot;</span> &lt;&lt; word &lt;&lt; endl;
<a name="l00255"></a>00255    }
<a name="l00256"></a>00256 
<a name="l00257"></a>00257    <span class="keywordflow">return</span> 0;
<a name="l00258"></a>00258 }
<a name="l00259"></a>00259 
<a name="l00260"></a><a class="code" href="glvis_8cpp.html#a882a2a898bd3baae6acdc76051c56227">00260</a> <span class="keywordtype">int</span> <a class="code" href="glvis_8cpp.html#a882a2a898bd3baae6acdc76051c56227">ScriptReadDisplMesh</a>(istream &amp;scr, Mesh **mp, GridFunction **sp)
<a name="l00261"></a>00261 {
<a name="l00262"></a>00262    Mesh *m;
<a name="l00263"></a>00263    <span class="keywordtype">string</span> word;
<a name="l00264"></a>00264 
<a name="l00265"></a>00265    cout &lt;&lt; <span class="stringliteral">&quot;Script: mesh: &quot;</span> &lt;&lt; flush;
<a name="l00266"></a>00266    scr &gt;&gt; ws &gt;&gt; word;
<a name="l00267"></a>00267    {
<a name="l00268"></a>00268       ifstream imesh(word.c_str());
<a name="l00269"></a>00269       <span class="keywordflow">if</span> (!imesh)
<a name="l00270"></a>00270       {
<a name="l00271"></a>00271          cout &lt;&lt; <span class="stringliteral">&quot;Can not open mesh file: &quot;</span> &lt;&lt; word &lt;&lt; endl;
<a name="l00272"></a>00272          <span class="keywordflow">return</span> 1;
<a name="l00273"></a>00273       }
<a name="l00274"></a>00274       cout &lt;&lt; word &lt;&lt; endl;
<a name="l00275"></a>00275       m = <span class="keyword">new</span> Mesh(imesh, 1, 0);
<a name="l00276"></a>00276    }
<a name="l00277"></a>00277    <span class="keywordflow">if</span> (<a class="code" href="glvis_8cpp.html#a6541d4ec47f9c1b3cd475b2e1ed73262">init_nodes</a> == NULL)
<a name="l00278"></a>00278    {
<a name="l00279"></a>00279       <a class="code" href="glvis_8cpp.html#a6541d4ec47f9c1b3cd475b2e1ed73262">init_nodes</a> = <span class="keyword">new</span> Vector;
<a name="l00280"></a>00280       m-&gt;GetNodes(*<a class="code" href="glvis_8cpp.html#a6541d4ec47f9c1b3cd475b2e1ed73262">init_nodes</a>);
<a name="l00281"></a>00281       <span class="keyword">delete</span> m;
<a name="l00282"></a>00282       *mp = NULL;
<a name="l00283"></a>00283       *sp = NULL;
<a name="l00284"></a>00284    }
<a name="l00285"></a>00285    <span class="keywordflow">else</span>
<a name="l00286"></a>00286    {
<a name="l00287"></a>00287       FiniteElementCollection  *vfec = NULL;
<a name="l00288"></a>00288       FiniteElementSpace *vfes;
<a name="l00289"></a>00289       GridFunction *g;
<a name="l00290"></a>00290       vfes = (FiniteElementSpace *)m-&gt;GetNodalFESpace();
<a name="l00291"></a>00291       <span class="keywordflow">if</span> (vfes == NULL)
<a name="l00292"></a>00292       {
<a name="l00293"></a>00293          vfec = <span class="keyword">new</span> LinearFECollection;
<a name="l00294"></a>00294          vfes = <span class="keyword">new</span> FiniteElementSpace(m, vfec, <a class="code" href="glvis_8cpp.html#a6e08f89b32254fb4b129720418e7c6ea">mesh</a>-&gt;Dimension());
<a name="l00295"></a>00295       }
<a name="l00296"></a>00296 
<a name="l00297"></a>00297       g = <span class="keyword">new</span> GridFunction(vfes);
<a name="l00298"></a>00298       <span class="keywordflow">if</span> (vfec)
<a name="l00299"></a>00299          g-&gt;MakeOwner(vfec);
<a name="l00300"></a>00300       m-&gt;GetNodes(*g);
<a name="l00301"></a>00301       <span class="keywordflow">if</span> (g-&gt;Size() == <a class="code" href="glvis_8cpp.html#a6541d4ec47f9c1b3cd475b2e1ed73262">init_nodes</a>-&gt;Size())
<a name="l00302"></a>00302       {
<a name="l00303"></a>00303          subtract(*<a class="code" href="glvis_8cpp.html#a6541d4ec47f9c1b3cd475b2e1ed73262">init_nodes</a>, *g, *g);
<a name="l00304"></a>00304       }
<a name="l00305"></a>00305       <span class="keywordflow">else</span>
<a name="l00306"></a>00306       {
<a name="l00307"></a>00307          cout &lt;&lt; <span class="stringliteral">&quot;Script: incompatible meshes!&quot;</span> &lt;&lt; endl;
<a name="l00308"></a>00308          *g = 0.0;
<a name="l00309"></a>00309       }
<a name="l00310"></a>00310       *mp = m;
<a name="l00311"></a>00311       *sp = g;
<a name="l00312"></a>00312    }
<a name="l00313"></a>00313 
<a name="l00314"></a>00314    <span class="keywordflow">return</span> 0;
<a name="l00315"></a>00315 }
<a name="l00316"></a>00316 
<a name="l00317"></a><a class="code" href="glvis_8cpp.html#a599c7479747f6bcd66d9462aaae275d3">00317</a> <span class="keywordtype">void</span> <a class="code" href="glvis_8cpp.html#a599c7479747f6bcd66d9462aaae275d3">ExecuteScriptCommand</a>()
<a name="l00318"></a>00318 {
<a name="l00319"></a>00319    <span class="keywordflow">if</span> (!<a class="code" href="glvis_8cpp.html#ac2e15ab8707cf0b5252fea4a2b413de5">script</a>)
<a name="l00320"></a>00320    {
<a name="l00321"></a>00321       cout &lt;&lt; <span class="stringliteral">&quot;No script stream defined! (Bug?)&quot;</span> &lt;&lt; endl;
<a name="l00322"></a>00322       <span class="keywordflow">return</span>;
<a name="l00323"></a>00323    }
<a name="l00324"></a>00324 
<a name="l00325"></a>00325    istream &amp;scr = *<a class="code" href="glvis_8cpp.html#ac2e15ab8707cf0b5252fea4a2b413de5">script</a>;
<a name="l00326"></a>00326 
<a name="l00327"></a>00327 <span class="preprocessor">#ifdef GLVIS_USE_LIBTIFF</span>
<a name="l00328"></a>00328 <span class="preprocessor"></span>   <span class="keyword">const</span> <span class="keywordtype">string</span> ext = <span class="stringliteral">&quot;.tif&quot;</span>;
<a name="l00329"></a>00329 <span class="preprocessor">#else</span>
<a name="l00330"></a>00330 <span class="preprocessor"></span>   <span class="keyword">const</span> <span class="keywordtype">string</span> ext = <span class="stringliteral">&quot;.xwd&quot;</span>;
<a name="l00331"></a>00331 <span class="preprocessor">#endif</span>
<a name="l00332"></a>00332 <span class="preprocessor"></span>
<a name="l00333"></a>00333    <span class="keywordtype">string</span> word;
<a name="l00334"></a>00334    <span class="keywordtype">int</span> done_one_command = 0;
<a name="l00335"></a>00335    <span class="keywordflow">while</span> (!done_one_command)
<a name="l00336"></a>00336    {
<a name="l00337"></a>00337       scr &gt;&gt; ws;
<a name="l00338"></a>00338       <span class="keywordflow">if</span> (!scr.good())
<a name="l00339"></a>00339       {
<a name="l00340"></a>00340          cout &lt;&lt; <span class="stringliteral">&quot;End of script.&quot;</span> &lt;&lt; endl;
<a name="l00341"></a>00341          <a class="code" href="glvis_8cpp.html#abf425bbc686fbedef7e537b5a3743788">scr_level</a> = 0;
<a name="l00342"></a>00342          <span class="keywordflow">return</span>;
<a name="l00343"></a>00343       }
<a name="l00344"></a>00344       <span class="keywordflow">if</span> (scr.peek() == <span class="charliteral">&#39;#&#39;</span>)
<a name="l00345"></a>00345       {
<a name="l00346"></a>00346          getline(scr, word);
<a name="l00347"></a>00347          <span class="keywordflow">continue</span>;
<a name="l00348"></a>00348       }
<a name="l00349"></a>00349       scr &gt;&gt; word;
<a name="l00350"></a>00350       <span class="keywordflow">if</span> (word == <span class="stringliteral">&quot;{&quot;</span>)
<a name="l00351"></a>00351       {
<a name="l00352"></a>00352          <a class="code" href="glvis_8cpp.html#abf425bbc686fbedef7e537b5a3743788">scr_level</a>++;
<a name="l00353"></a>00353       }
<a name="l00354"></a>00354       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (word == <span class="stringliteral">&quot;}&quot;</span>)
<a name="l00355"></a>00355       {
<a name="l00356"></a>00356          <a class="code" href="glvis_8cpp.html#abf425bbc686fbedef7e537b5a3743788">scr_level</a>--;
<a name="l00357"></a>00357          <span class="keywordflow">if</span> (<a class="code" href="glvis_8cpp.html#abf425bbc686fbedef7e537b5a3743788">scr_level</a> &lt; 0)
<a name="l00358"></a>00358             <a class="code" href="glvis_8cpp.html#abf425bbc686fbedef7e537b5a3743788">scr_level</a> = 0;
<a name="l00359"></a>00359       }
<a name="l00360"></a>00360       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (word == <span class="stringliteral">&quot;solution&quot;</span> || word == <span class="stringliteral">&quot;mesh&quot;</span>)
<a name="l00361"></a>00361       {
<a name="l00362"></a>00362          Mesh *new_m;
<a name="l00363"></a>00363          GridFunction *new_g;
<a name="l00364"></a>00364 
<a name="l00365"></a>00365          <span class="keywordflow">if</span> (word == <span class="stringliteral">&quot;solution&quot;</span>)
<a name="l00366"></a>00366          {
<a name="l00367"></a>00367             <span class="keywordflow">if</span> (<a class="code" href="glvis_8cpp.html#a7338b117485f5eb4d304888a33049e31">ScriptReadSolution</a>(scr, &amp;new_m, &amp;new_g))
<a name="l00368"></a>00368             {
<a name="l00369"></a>00369                done_one_command = 1;
<a name="l00370"></a>00370                <span class="keywordflow">continue</span>;
<a name="l00371"></a>00371             }
<a name="l00372"></a>00372          }
<a name="l00373"></a>00373          <span class="keywordflow">else</span> <span class="comment">// word == &quot;mesh&quot;</span>
<a name="l00374"></a>00374          {
<a name="l00375"></a>00375             <span class="keywordflow">if</span> (<a class="code" href="glvis_8cpp.html#a882a2a898bd3baae6acdc76051c56227">ScriptReadDisplMesh</a>(scr, &amp;new_m, &amp;new_g))
<a name="l00376"></a>00376             {
<a name="l00377"></a>00377                done_one_command = 1;
<a name="l00378"></a>00378                <span class="keywordflow">continue</span>;
<a name="l00379"></a>00379             }
<a name="l00380"></a>00380             <span class="keywordflow">if</span> (new_m == NULL)
<a name="l00381"></a>00381             {
<a name="l00382"></a>00382                cout &lt;&lt; <span class="stringliteral">&quot;Script: unexpected &#39;mesh&#39; command!&quot;</span> &lt;&lt; endl;
<a name="l00383"></a>00383                done_one_command = 1;
<a name="l00384"></a>00384                <span class="keywordflow">continue</span>;
<a name="l00385"></a>00385             }
<a name="l00386"></a>00386          }
<a name="l00387"></a>00387 
<a name="l00388"></a>00388          <span class="keywordflow">if</span> (new_m-&gt;Dimension() == <a class="code" href="glvis_8cpp.html#a6e08f89b32254fb4b129720418e7c6ea">mesh</a>-&gt;Dimension() &amp;&amp;
<a name="l00389"></a>00389              new_g-&gt;VectorDim() == <a class="code" href="glvis_8cpp.html#a25f770a09ffb9eedb1bd5cea6429b871">grid_f</a>-&gt;VectorDim())
<a name="l00390"></a>00390          {
<a name="l00391"></a>00391             <span class="keywordflow">if</span> (new_m-&gt;Dimension() == 2)
<a name="l00392"></a>00392             {
<a name="l00393"></a>00393                <span class="keywordflow">if</span> (new_g-&gt;VectorDim() == 1)
<a name="l00394"></a>00394                {
<a name="l00395"></a>00395                   <a class="code" href="classVisualizationSceneSolution.html">VisualizationSceneSolution</a> *vss =
<a name="l00396"></a>00396                      <span class="keyword">dynamic_cast&lt;</span><a class="code" href="classVisualizationSceneSolution.html">VisualizationSceneSolution</a> *<span class="keyword">&gt;</span>(<a class="code" href="glvis_8cpp.html#af7feceb354d564ca3e8fa1a2e3adee36">vs</a>);
<a name="l00397"></a>00397                   new_g-&gt;GetNodalValues(<a class="code" href="glvis_8cpp.html#abdff2ecf770abe7e9e10d3ac91efecc2">sol</a>);
<a name="l00398"></a>00398                   vss-&gt;<a class="code" href="classVisualizationSceneSolution.html#a867b47b5047dff7bbe1bbef92d0d9721">NewMeshAndSolution</a>(new_m, &amp;<a class="code" href="glvis_8cpp.html#abdff2ecf770abe7e9e10d3ac91efecc2">sol</a>, new_g,
<a name="l00399"></a>00399                                           <a class="code" href="glvis_8cpp.html#af4af2b70781b30ab9adbc5050d80e996">scr_sol_autoscale</a>);
<a name="l00400"></a>00400                }
<a name="l00401"></a>00401                <span class="keywordflow">else</span>
<a name="l00402"></a>00402                {
<a name="l00403"></a>00403                   <a class="code" href="classVisualizationSceneVector.html">VisualizationSceneVector</a> *vsv =
<a name="l00404"></a>00404                      <span class="keyword">dynamic_cast&lt;</span><a class="code" href="classVisualizationSceneVector.html">VisualizationSceneVector</a> *<span class="keyword">&gt;</span>(<a class="code" href="glvis_8cpp.html#af7feceb354d564ca3e8fa1a2e3adee36">vs</a>);
<a name="l00405"></a>00405                   vsv-&gt;<a class="code" href="classVisualizationSceneVector.html#a258844d5d4b88f2bd6a9cd5f60dc1a3b">NewMeshAndSolution</a>(*new_g, <a class="code" href="glvis_8cpp.html#af4af2b70781b30ab9adbc5050d80e996">scr_sol_autoscale</a>);
<a name="l00406"></a>00406                }
<a name="l00407"></a>00407             }
<a name="l00408"></a>00408             <span class="keywordflow">else</span>
<a name="l00409"></a>00409             {
<a name="l00410"></a>00410                <span class="keywordflow">if</span> (new_g-&gt;VectorDim() == 1)
<a name="l00411"></a>00411                {
<a name="l00412"></a>00412                   <a class="code" href="classVisualizationSceneSolution3d.html">VisualizationSceneSolution3d</a> *vss =
<a name="l00413"></a>00413                      <span class="keyword">dynamic_cast&lt;</span><a class="code" href="classVisualizationSceneSolution3d.html">VisualizationSceneSolution3d</a> *<span class="keyword">&gt;</span>(<a class="code" href="glvis_8cpp.html#af7feceb354d564ca3e8fa1a2e3adee36">vs</a>);
<a name="l00414"></a>00414                   new_g-&gt;GetNodalValues(<a class="code" href="glvis_8cpp.html#abdff2ecf770abe7e9e10d3ac91efecc2">sol</a>);
<a name="l00415"></a>00415                   vss-&gt;<a class="code" href="classVisualizationSceneSolution3d.html#a0a73c9008a7ac5d89377b4a77485b5cc">NewMeshAndSolution</a>(new_m, &amp;<a class="code" href="glvis_8cpp.html#abdff2ecf770abe7e9e10d3ac91efecc2">sol</a>, new_g,
<a name="l00416"></a>00416                                           <a class="code" href="glvis_8cpp.html#af4af2b70781b30ab9adbc5050d80e996">scr_sol_autoscale</a>);
<a name="l00417"></a>00417                }
<a name="l00418"></a>00418                <span class="keywordflow">else</span>
<a name="l00419"></a>00419                {
<a name="l00420"></a>00420                   <span class="comment">// 3D vector field ...</span>
<a name="l00421"></a>00421                }
<a name="l00422"></a>00422             }
<a name="l00423"></a>00423             <span class="keyword">delete</span> <a class="code" href="glvis_8cpp.html#a25f770a09ffb9eedb1bd5cea6429b871">grid_f</a>; <a class="code" href="glvis_8cpp.html#a25f770a09ffb9eedb1bd5cea6429b871">grid_f</a> = new_g;
<a name="l00424"></a>00424             <span class="keyword">delete</span> <a class="code" href="glvis_8cpp.html#a6e08f89b32254fb4b129720418e7c6ea">mesh</a>; <a class="code" href="glvis_8cpp.html#a6e08f89b32254fb4b129720418e7c6ea">mesh</a> = new_m;
<a name="l00425"></a>00425 
<a name="l00426"></a>00426             vs-&gt;<a class="code" href="classVisualizationScene.html#a4ab08d5ca58ad6403ff6b27e3a557e0e">Draw</a>();
<a name="l00427"></a>00427          }
<a name="l00428"></a>00428          <span class="keywordflow">else</span>
<a name="l00429"></a>00429          {
<a name="l00430"></a>00430             cout &lt;&lt; <span class="stringliteral">&quot;Different type of mesh / solution.&quot;</span> &lt;&lt; endl;
<a name="l00431"></a>00431             <span class="keyword">delete</span> new_g;
<a name="l00432"></a>00432             <span class="keyword">delete</span> new_m;
<a name="l00433"></a>00433          }
<a name="l00434"></a>00434       }
<a name="l00435"></a>00435       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (word == <span class="stringliteral">&quot;screenshot&quot;</span>)
<a name="l00436"></a>00436       {
<a name="l00437"></a>00437          <span class="keywordtype">int</span> err;
<a name="l00438"></a>00438          scr &gt;&gt; ws &gt;&gt; word;
<a name="l00439"></a>00439 
<a name="l00440"></a>00440          cout &lt;&lt; <span class="stringliteral">&quot;Script: screenshot: &quot;</span> &lt;&lt; flush;
<a name="l00441"></a>00441 
<a name="l00442"></a>00442          <span class="keywordflow">if</span> (<a class="code" href="aux__vis_8cpp.html#a90d8baba57f55aec132d98d524df9cc4" title="Take a screenshot using libtiff or xwd.">Screenshot</a>(word.c_str()))
<a name="l00443"></a>00443          {
<a name="l00444"></a>00444             cout &lt;&lt; <span class="stringliteral">&quot;Screenshot(&quot;</span> &lt;&lt; word &lt;&lt; <span class="stringliteral">&quot;) failed.&quot;</span> &lt;&lt; endl;
<a name="l00445"></a>00445             done_one_command = 1;
<a name="l00446"></a>00446             <span class="keywordflow">continue</span>;
<a name="l00447"></a>00447          }
<a name="l00448"></a>00448          cout &lt;&lt; <span class="stringliteral">&quot;-&gt; &quot;</span> &lt;&lt; word &lt;&lt; ext &lt;&lt; flush;
<a name="l00449"></a>00449 
<a name="l00450"></a>00450          ostringstream cmd;
<a name="l00451"></a>00451          cmd &lt;&lt; <span class="stringliteral">&quot;convert &quot;</span> &lt;&lt; word &lt;&lt; ext &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; word;
<a name="l00452"></a>00452          err = system(cmd.str().c_str());
<a name="l00453"></a>00453          <span class="keywordflow">if</span> (err)
<a name="l00454"></a>00454             cout &lt;&lt; <span class="stringliteral">&quot;; convert failed.&quot;</span> &lt;&lt; endl;
<a name="l00455"></a>00455          <span class="keywordflow">else</span>
<a name="l00456"></a>00456             cout &lt;&lt; <span class="stringliteral">&quot; -&gt; &quot;</span> &lt;&lt; word &lt;&lt; endl;
<a name="l00457"></a>00457 
<a name="l00458"></a>00458          cmd.str(<span class="stringliteral">&quot;&quot;</span>);
<a name="l00459"></a>00459          cmd &lt;&lt; word &lt;&lt; ext;
<a name="l00460"></a>00460          <span class="keyword">remove</span>(cmd.str().c_str());
<a name="l00461"></a>00461 
<a name="l00462"></a>00462          <span class="keywordflow">if</span> (<a class="code" href="glvis_8cpp.html#a595e4cfb0d88ad5063879cfd71fee1d3">scr_min_val</a> &gt; vs-&gt;<a class="code" href="classVisualizationSceneScalarData.html#ab1c7e2ffecd77fd87037ad9468f4a9d3">GetMinV</a>())
<a name="l00463"></a>00463             <a class="code" href="glvis_8cpp.html#a595e4cfb0d88ad5063879cfd71fee1d3">scr_min_val</a> = vs-&gt;<a class="code" href="classVisualizationSceneScalarData.html#ab1c7e2ffecd77fd87037ad9468f4a9d3">GetMinV</a>();
<a name="l00464"></a>00464          <span class="keywordflow">if</span> (scr_max_val &lt; vs-&gt;GetMaxV())
<a name="l00465"></a>00465             <a class="code" href="glvis_8cpp.html#af3b4b81d02c5ed6da83ef0f3a3c62669">scr_max_val</a> = vs-&gt;<a class="code" href="classVisualizationSceneScalarData.html#aa88e2a87be31eaccb8a631b9080847bb">GetMaxV</a>();
<a name="l00466"></a>00466       }
<a name="l00467"></a>00467       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (word == <span class="stringliteral">&quot;viewcenter&quot;</span>)
<a name="l00468"></a>00468       {
<a name="l00469"></a>00469          scr &gt;&gt; vs-&gt;<a class="code" href="classVisualizationScene.html#a6dd849cc503967f63c871bfe7e7aefa1">ViewCenterX</a> &gt;&gt; vs-&gt;<a class="code" href="classVisualizationScene.html#a777f84671db75531c4f7ceda0653dc28">ViewCenterY</a>;
<a name="l00470"></a>00470          cout &lt;&lt; <span class="stringliteral">&quot;Script: viewcenter: &quot;</span>
<a name="l00471"></a>00471               &lt;&lt; vs-&gt;<a class="code" href="classVisualizationScene.html#a6dd849cc503967f63c871bfe7e7aefa1">ViewCenterX</a> &lt;&lt; <span class="charliteral">&#39; &#39;</span> &lt;&lt; vs-&gt;<a class="code" href="classVisualizationScene.html#a777f84671db75531c4f7ceda0653dc28">ViewCenterY</a> &lt;&lt; endl;
<a name="l00472"></a>00472          <a class="code" href="aux__vis_8cpp.html#a14c66e50f40292c34164e713f845e9c7">MyExpose</a>();
<a name="l00473"></a>00473       }
<a name="l00474"></a>00474       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (word ==  <span class="stringliteral">&quot;perspective&quot;</span>)
<a name="l00475"></a>00475       {
<a name="l00476"></a>00476          scr &gt;&gt; ws &gt;&gt; word;
<a name="l00477"></a>00477          cout &lt;&lt; <span class="stringliteral">&quot;Script: perspective: &quot;</span> &lt;&lt; word;
<a name="l00478"></a>00478          <span class="keywordflow">if</span> (word == <span class="stringliteral">&quot;off&quot;</span>)
<a name="l00479"></a>00479          {
<a name="l00480"></a>00480             vs-&gt;<a class="code" href="classVisualizationScene.html#a260ebcb0c24e3883a7ce5d5daa1b5bff">OrthogonalProjection</a> = 1;
<a name="l00481"></a>00481          }
<a name="l00482"></a>00482          <span class="keywordflow">else</span> <span class="keywordflow">if</span> (word == <span class="stringliteral">&quot;on&quot;</span>)
<a name="l00483"></a>00483          {
<a name="l00484"></a>00484             vs-&gt;<a class="code" href="classVisualizationScene.html#a260ebcb0c24e3883a7ce5d5daa1b5bff">OrthogonalProjection</a> = 0;
<a name="l00485"></a>00485          }
<a name="l00486"></a>00486          <span class="keywordflow">else</span>
<a name="l00487"></a>00487          {
<a name="l00488"></a>00488             cout &lt;&lt; <span class="charliteral">&#39;?&#39;</span>;
<a name="l00489"></a>00489          }
<a name="l00490"></a>00490          cout &lt;&lt; endl;
<a name="l00491"></a>00491          <a class="code" href="aux__vis_8cpp.html#a14c66e50f40292c34164e713f845e9c7">MyExpose</a>();
<a name="l00492"></a>00492       }
<a name="l00493"></a>00493       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (word ==  <span class="stringliteral">&quot;light&quot;</span>)
<a name="l00494"></a>00494       {
<a name="l00495"></a>00495          scr &gt;&gt; ws &gt;&gt; word;
<a name="l00496"></a>00496          cout &lt;&lt; <span class="stringliteral">&quot;Script: light: &quot;</span> &lt;&lt; word;
<a name="l00497"></a>00497          <span class="keywordflow">if</span> (word == <span class="stringliteral">&quot;off&quot;</span>)
<a name="l00498"></a>00498          {
<a name="l00499"></a>00499             vs-&gt;<a class="code" href="classVisualizationSceneScalarData.html#a3aa3bcd5e0788dced72f08724617687e">light</a> = 0;
<a name="l00500"></a>00500          }
<a name="l00501"></a>00501          <span class="keywordflow">else</span> <span class="keywordflow">if</span> (word == <span class="stringliteral">&quot;on&quot;</span>)
<a name="l00502"></a>00502          {
<a name="l00503"></a>00503             vs-&gt;<a class="code" href="classVisualizationSceneScalarData.html#a3aa3bcd5e0788dced72f08724617687e">light</a> = 1;
<a name="l00504"></a>00504          }
<a name="l00505"></a>00505          <span class="keywordflow">else</span>
<a name="l00506"></a>00506          {
<a name="l00507"></a>00507             cout &lt;&lt; <span class="charliteral">&#39;?&#39;</span>;
<a name="l00508"></a>00508          }
<a name="l00509"></a>00509          cout &lt;&lt; endl;
<a name="l00510"></a>00510          <a class="code" href="aux__vis_8cpp.html#a14c66e50f40292c34164e713f845e9c7">MyExpose</a>();
<a name="l00511"></a>00511       }
<a name="l00512"></a>00512       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (word == <span class="stringliteral">&quot;view&quot;</span>)
<a name="l00513"></a>00513       {
<a name="l00514"></a>00514          <span class="keywordtype">double</span> theta, phi;
<a name="l00515"></a>00515          scr &gt;&gt; theta &gt;&gt; phi;
<a name="l00516"></a>00516          cout &lt;&lt; <span class="stringliteral">&quot;Script: view: &quot;</span> &lt;&lt; theta &lt;&lt; <span class="charliteral">&#39; &#39;</span> &lt;&lt; phi &lt;&lt; endl;
<a name="l00517"></a>00517          vs-&gt;<a class="code" href="classVisualizationScene.html#a7d41f612cb3c5e31e7de1f5ce2e55793">SetView</a>(theta, phi);
<a name="l00518"></a>00518          <a class="code" href="aux__vis_8cpp.html#a14c66e50f40292c34164e713f845e9c7">MyExpose</a>();
<a name="l00519"></a>00519       }
<a name="l00520"></a>00520       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (word == <span class="stringliteral">&quot;zoom&quot;</span>)
<a name="l00521"></a>00521       {
<a name="l00522"></a>00522          <span class="keywordtype">double</span> factor;
<a name="l00523"></a>00523          scr &gt;&gt; factor;
<a name="l00524"></a>00524          cout &lt;&lt; <span class="stringliteral">&quot;Script: zoom: &quot;</span> &lt;&lt; factor &lt;&lt; endl;
<a name="l00525"></a>00525          vs-&gt;<a class="code" href="classVisualizationScene.html#a8fae552e673d1855a23397c1582d7d4b">Zoom</a>(factor);
<a name="l00526"></a>00526          <a class="code" href="aux__vis_8cpp.html#a14c66e50f40292c34164e713f845e9c7">MyExpose</a>();
<a name="l00527"></a>00527       }
<a name="l00528"></a>00528       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (word == <span class="stringliteral">&quot;shading&quot;</span>)
<a name="l00529"></a>00529       {
<a name="l00530"></a>00530          scr &gt;&gt; ws &gt;&gt; word;
<a name="l00531"></a>00531          cout &lt;&lt; <span class="stringliteral">&quot;Script: shading: &quot;</span> &lt;&lt; flush;
<a name="l00532"></a>00532          <span class="keywordtype">int</span> s = -1;
<a name="l00533"></a>00533          <span class="keywordflow">if</span> (word == <span class="stringliteral">&quot;flat&quot;</span>)
<a name="l00534"></a>00534             s = 0;
<a name="l00535"></a>00535          <span class="keywordflow">else</span> <span class="keywordflow">if</span> (word == <span class="stringliteral">&quot;smooth&quot;</span>)
<a name="l00536"></a>00536             s = 1;
<a name="l00537"></a>00537          <span class="keywordflow">else</span> <span class="keywordflow">if</span> (word == <span class="stringliteral">&quot;cool&quot;</span>)
<a name="l00538"></a>00538             s = 2;
<a name="l00539"></a>00539          <span class="keywordflow">if</span> (s != -1)
<a name="l00540"></a>00540          {
<a name="l00541"></a>00541             vs-&gt;<a class="code" href="classVisualizationSceneScalarData.html#a5c8540d22e1ccf3deb3cd35e8a6317f0">SetShading</a>(s);
<a name="l00542"></a>00542             cout &lt;&lt; word &lt;&lt; endl;
<a name="l00543"></a>00543             <a class="code" href="aux__vis_8cpp.html#a14c66e50f40292c34164e713f845e9c7">MyExpose</a>();
<a name="l00544"></a>00544          }
<a name="l00545"></a>00545          <span class="keywordflow">else</span>
<a name="l00546"></a>00546          {
<a name="l00547"></a>00547             cout &lt;&lt; word &lt;&lt; <span class="stringliteral">&quot; ?&quot;</span> &lt;&lt; endl;
<a name="l00548"></a>00548          }
<a name="l00549"></a>00549       }
<a name="l00550"></a>00550       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (word == <span class="stringliteral">&quot;subdivisions&quot;</span>)
<a name="l00551"></a>00551       {
<a name="l00552"></a>00552          <span class="keywordtype">int</span> t, b;
<a name="l00553"></a>00553          scr &gt;&gt; t &gt;&gt; b;
<a name="l00554"></a>00554          cout &lt;&lt; <span class="stringliteral">&quot;Script: subdivisions: &quot;</span> &lt;&lt; flush;
<a name="l00555"></a>00555          vs-&gt;<a class="code" href="classVisualizationSceneScalarData.html#a5091aaaead0699771bac466b2082943d">SetRefineFactors</a>(t, b);
<a name="l00556"></a>00556          cout &lt;&lt; t &lt;&lt; <span class="charliteral">&#39; &#39;</span> &lt;&lt; b &lt;&lt; endl;
<a name="l00557"></a>00557          <a class="code" href="aux__vis_8cpp.html#a14c66e50f40292c34164e713f845e9c7">MyExpose</a>();
<a name="l00558"></a>00558       }
<a name="l00559"></a>00559       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (word == <span class="stringliteral">&quot;valuerange&quot;</span>)
<a name="l00560"></a>00560       {
<a name="l00561"></a>00561          <span class="keywordtype">double</span> min, max;
<a name="l00562"></a>00562          scr &gt;&gt; min &gt;&gt; max;
<a name="l00563"></a>00563          cout &lt;&lt; <span class="stringliteral">&quot;Script: valuerange: &quot;</span> &lt;&lt; flush;
<a name="l00564"></a>00564          vs-&gt;<a class="code" href="classVisualizationSceneScalarData.html#a03d6de1181434b04da9183920a2eb232">SetValueRange</a>(min, max);
<a name="l00565"></a>00565          cout &lt;&lt; min &lt;&lt; <span class="charliteral">&#39; &#39;</span> &lt;&lt; max &lt;&lt; endl;
<a name="l00566"></a>00566          <a class="code" href="aux__vis_8cpp.html#a14c66e50f40292c34164e713f845e9c7">MyExpose</a>();
<a name="l00567"></a>00567       }
<a name="l00568"></a>00568       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (word == <span class="stringliteral">&quot;autoscale&quot;</span>)
<a name="l00569"></a>00569       {
<a name="l00570"></a>00570          scr &gt;&gt; ws &gt;&gt; word;
<a name="l00571"></a>00571          cout &lt;&lt; <span class="stringliteral">&quot;Script: autoscale: &quot;</span> &lt;&lt; word;
<a name="l00572"></a>00572          <span class="keywordflow">if</span> (word == <span class="stringliteral">&quot;off&quot;</span>)
<a name="l00573"></a>00573          {
<a name="l00574"></a>00574             <a class="code" href="glvis_8cpp.html#af4af2b70781b30ab9adbc5050d80e996">scr_sol_autoscale</a> = 0;
<a name="l00575"></a>00575          }
<a name="l00576"></a>00576          <span class="keywordflow">else</span> <span class="keywordflow">if</span> (word == <span class="stringliteral">&quot;on&quot;</span>)
<a name="l00577"></a>00577          {
<a name="l00578"></a>00578             <a class="code" href="glvis_8cpp.html#af4af2b70781b30ab9adbc5050d80e996">scr_sol_autoscale</a> = 1;
<a name="l00579"></a>00579          }
<a name="l00580"></a>00580          <span class="keywordflow">else</span> <span class="keywordflow">if</span> (word == <span class="stringliteral">&quot;value&quot;</span>)
<a name="l00581"></a>00581          {
<a name="l00582"></a>00582             <a class="code" href="glvis_8cpp.html#af4af2b70781b30ab9adbc5050d80e996">scr_sol_autoscale</a> = 2;
<a name="l00583"></a>00583          }
<a name="l00584"></a>00584          <span class="keywordflow">else</span>
<a name="l00585"></a>00585          {
<a name="l00586"></a>00586             cout &lt;&lt; <span class="charliteral">&#39;?&#39;</span>;
<a name="l00587"></a>00587          }
<a name="l00588"></a>00588          cout &lt;&lt; endl;
<a name="l00589"></a>00589       }
<a name="l00590"></a>00590       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (word == <span class="stringliteral">&quot;window&quot;</span>)
<a name="l00591"></a>00591       {
<a name="l00592"></a>00592          scr &gt;&gt; <a class="code" href="glvis_8cpp.html#a9ce11c4941669bb54ef502b68af07ec4">window_x</a> &gt;&gt; <a class="code" href="glvis_8cpp.html#a62627cc91e2bb07cf1033188a9863bfc">window_y</a> &gt;&gt; <a class="code" href="glvis_8cpp.html#a59f74fee0c8a623650109c9fb35d4fae">window_w</a> &gt;&gt; <a class="code" href="glvis_8cpp.html#a7b6ea03893fc7fb4126a3a0c2fb0c319">window_h</a>;
<a name="l00593"></a>00593          cout &lt;&lt; <span class="stringliteral">&quot;Script: window: &quot;</span> &lt;&lt; <a class="code" href="glvis_8cpp.html#a9ce11c4941669bb54ef502b68af07ec4">window_x</a> &lt;&lt; <span class="charliteral">&#39; &#39;</span> &lt;&lt; <a class="code" href="glvis_8cpp.html#a62627cc91e2bb07cf1033188a9863bfc">window_y</a>
<a name="l00594"></a>00594               &lt;&lt; <span class="charliteral">&#39; &#39;</span> &lt;&lt; <a class="code" href="glvis_8cpp.html#a59f74fee0c8a623650109c9fb35d4fae">window_w</a> &lt;&lt; <span class="charliteral">&#39; &#39;</span> &lt;&lt; window_h &lt;&lt; endl;
<a name="l00595"></a>00595          <a class="code" href="aux__vis_8cpp.html#a7347e880bf1f7ff39f82a33cf687b9a9">MoveResizeWindow</a>(<a class="code" href="glvis_8cpp.html#a9ce11c4941669bb54ef502b68af07ec4">window_x</a>, <a class="code" href="glvis_8cpp.html#a62627cc91e2bb07cf1033188a9863bfc">window_y</a>, <a class="code" href="glvis_8cpp.html#a59f74fee0c8a623650109c9fb35d4fae">window_w</a>, window_h);
<a name="l00596"></a>00596          <a class="code" href="aux__vis_8cpp.html#a14c66e50f40292c34164e713f845e9c7">MyExpose</a>();
<a name="l00597"></a>00597       }
<a name="l00598"></a>00598       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (word == <span class="stringliteral">&quot;keys&quot;</span>)
<a name="l00599"></a>00599       {
<a name="l00600"></a>00600          scr &gt;&gt; <a class="code" href="glvis_8cpp.html#a51ba742484f9bdff4502c62248f0ab5b">keys</a>;
<a name="l00601"></a>00601          cout &lt;&lt; <span class="stringliteral">&quot;Script: keys: &#39;&quot;</span> &lt;&lt; keys &lt;&lt; <span class="stringliteral">&quot;&#39;&quot;</span> &lt;&lt; endl;
<a name="l00602"></a>00602          <a class="code" href="aux__vis_8cpp.html#a205d7b73e3cb28f274cdd783454c067f" title="Send a sequence of keystrokes to the visualization window.">SendKeySequence</a>(keys);
<a name="l00603"></a>00603          <span class="comment">// MyExpose();</span>
<a name="l00604"></a>00604       }
<a name="l00605"></a>00605       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (word == <span class="stringliteral">&quot;palette&quot;</span>)
<a name="l00606"></a>00606       {
<a name="l00607"></a>00607          <span class="keywordtype">int</span> pal;
<a name="l00608"></a>00608          scr &gt;&gt; pal;
<a name="l00609"></a>00609          cout &lt;&lt; <span class="stringliteral">&quot;Script: palette: &quot;</span> &lt;&lt; pal &lt;&lt; endl;
<a name="l00610"></a>00610          <a class="code" href="glvis_8cpp.html#a99a4b7a7c6575486b93f03efc4a0100a">Set_Palette</a>(pal-1);
<a name="l00611"></a>00611          vs-&gt;<a class="code" href="classVisualizationSceneScalarData.html#a277f38cb6e7f562080b0b534f205b55c">EventUpdateColors</a>();
<a name="l00612"></a>00612          <a class="code" href="aux__vis_8cpp.html#a14c66e50f40292c34164e713f845e9c7">MyExpose</a>();
<a name="l00613"></a>00613       }
<a name="l00614"></a>00614       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (word == <span class="stringliteral">&quot;toggle_attributes&quot;</span>)
<a name="l00615"></a>00615       {
<a name="l00616"></a>00616          Array&lt;int&gt; attr_list;
<a name="l00617"></a>00617          cout &lt;&lt; <span class="stringliteral">&quot;Script: toggle_attributes:&quot;</span>;
<a name="l00618"></a>00618          <span class="keywordflow">for</span> (scr &gt;&gt; ws; scr.peek() != <span class="charliteral">&#39;;&#39;</span>; scr &gt;&gt; ws)
<a name="l00619"></a>00619          {
<a name="l00620"></a>00620             attr_list.Append(0);
<a name="l00621"></a>00621             scr &gt;&gt; attr_list.Last();
<a name="l00622"></a>00622             <span class="keywordflow">if</span> (attr_list.Size() &lt;= 256)
<a name="l00623"></a>00623                cout &lt;&lt; <span class="charliteral">&#39; &#39;</span> &lt;&lt; attr_list.Last();
<a name="l00624"></a>00624             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (attr_list.Size() == 257)
<a name="l00625"></a>00625                cout &lt;&lt; <span class="stringliteral">&quot; ... &quot;</span> &lt;&lt; flush;
<a name="l00626"></a>00626          }
<a name="l00627"></a>00627          scr.get(); <span class="comment">// read the end symbol: &#39;;&#39;</span>
<a name="l00628"></a>00628          cout &lt;&lt; endl;
<a name="l00629"></a>00629          vs-&gt;<a class="code" href="classVisualizationSceneScalarData.html#a526a599d70883aa38d47fb2195da5aa0">ToggleAttributes</a>(attr_list);
<a name="l00630"></a>00630          <a class="code" href="aux__vis_8cpp.html#a14c66e50f40292c34164e713f845e9c7">MyExpose</a>();
<a name="l00631"></a>00631       }
<a name="l00632"></a>00632       <span class="keywordflow">else</span>
<a name="l00633"></a>00633       {
<a name="l00634"></a>00634          cout &lt;&lt; <span class="stringliteral">&quot;Unknown command in script: &quot;</span> &lt;&lt; word &lt;&lt; endl;
<a name="l00635"></a>00635       }
<a name="l00636"></a>00636 
<a name="l00637"></a>00637       done_one_command = 1;
<a name="l00638"></a>00638    }
<a name="l00639"></a>00639 }
<a name="l00640"></a>00640 
<a name="l00641"></a>00641 <span class="keywordtype">void</span> <a class="code" href="glvis_8cpp.html#a24d99f34f0427dd99ee37bc356e8973a">ScriptControl</a>();
<a name="l00642"></a>00642 
<a name="l00643"></a><a class="code" href="glvis_8cpp.html#a906413c16cd29fb0f7cbb5ba24fe19b6">00643</a> <span class="keywordtype">void</span> <a class="code" href="glvis_8cpp.html#a906413c16cd29fb0f7cbb5ba24fe19b6">ScriptIdleFunc</a>()
<a name="l00644"></a>00644 {
<a name="l00645"></a>00645    <a class="code" href="glvis_8cpp.html#a599c7479747f6bcd66d9462aaae275d3">ExecuteScriptCommand</a>();
<a name="l00646"></a>00646    <span class="keywordflow">if</span> (<a class="code" href="glvis_8cpp.html#abf425bbc686fbedef7e537b5a3743788">scr_level</a> == 0)
<a name="l00647"></a>00647       <a class="code" href="glvis_8cpp.html#a24d99f34f0427dd99ee37bc356e8973a">ScriptControl</a>();
<a name="l00648"></a>00648 }
<a name="l00649"></a>00649 
<a name="l00650"></a><a class="code" href="glvis_8cpp.html#a24d99f34f0427dd99ee37bc356e8973a">00650</a> <span class="keywordtype">void</span> <a class="code" href="glvis_8cpp.html#a24d99f34f0427dd99ee37bc356e8973a">ScriptControl</a>()
<a name="l00651"></a>00651 {
<a name="l00652"></a>00652    <span class="keywordflow">if</span> (<a class="code" href="glvis_8cpp.html#ac9a204cfe1cf4cf44eb62b5833fb7a59">scr_running</a>)
<a name="l00653"></a>00653    {
<a name="l00654"></a>00654       <a class="code" href="glvis_8cpp.html#ac9a204cfe1cf4cf44eb62b5833fb7a59">scr_running</a> = 0;
<a name="l00655"></a>00655       <a class="code" href="aux__vis_8cpp.html#a6a3c865cab4476fb4f52d88a7e0b24a1">RemoveIdleFunc</a>(<a class="code" href="glvis_8cpp.html#a906413c16cd29fb0f7cbb5ba24fe19b6">ScriptIdleFunc</a>);
<a name="l00656"></a>00656    }
<a name="l00657"></a>00657    <span class="keywordflow">else</span>
<a name="l00658"></a>00658    {
<a name="l00659"></a>00659       <a class="code" href="glvis_8cpp.html#ac9a204cfe1cf4cf44eb62b5833fb7a59">scr_running</a> = 1;
<a name="l00660"></a>00660       <a class="code" href="aux__vis_8cpp.html#a902196002355b22363b8573023eff4bf">AddIdleFunc</a>(<a class="code" href="glvis_8cpp.html#a906413c16cd29fb0f7cbb5ba24fe19b6">ScriptIdleFunc</a>);
<a name="l00661"></a>00661    }
<a name="l00662"></a>00662 }
<a name="l00663"></a>00663 
<a name="l00664"></a><a class="code" href="glvis_8cpp.html#a79ac0aed09c13aac298ae36c4bd303a0">00664</a> <span class="keywordtype">void</span> <a class="code" href="glvis_8cpp.html#a79ac0aed09c13aac298ae36c4bd303a0">PlayScript</a>(istream &amp;scr)
<a name="l00665"></a>00665 {
<a name="l00666"></a>00666    <span class="keywordtype">string</span> word;
<a name="l00667"></a>00667 
<a name="l00668"></a>00668    <a class="code" href="glvis_8cpp.html#a595e4cfb0d88ad5063879cfd71fee1d3">scr_min_val</a> = numeric_limits&lt;double&gt;::infinity();
<a name="l00669"></a>00669    <a class="code" href="glvis_8cpp.html#af3b4b81d02c5ed6da83ef0f3a3c62669">scr_max_val</a> = -<a class="code" href="glvis_8cpp.html#a595e4cfb0d88ad5063879cfd71fee1d3">scr_min_val</a>;
<a name="l00670"></a>00670 
<a name="l00671"></a>00671    <span class="comment">// read initializing commands</span>
<a name="l00672"></a>00672    <span class="keywordflow">while</span> (1)
<a name="l00673"></a>00673    {
<a name="l00674"></a>00674       scr &gt;&gt; ws;
<a name="l00675"></a>00675       <span class="keywordflow">if</span> (!scr.good())
<a name="l00676"></a>00676       {
<a name="l00677"></a>00677          cout &lt;&lt; <span class="stringliteral">&quot;Error in script&quot;</span> &lt;&lt; endl;
<a name="l00678"></a>00678          <span class="keywordflow">return</span>;
<a name="l00679"></a>00679       }
<a name="l00680"></a>00680       <span class="keywordflow">if</span> (scr.peek() == <span class="charliteral">&#39;#&#39;</span>)
<a name="l00681"></a>00681       {
<a name="l00682"></a>00682          getline(scr, word);
<a name="l00683"></a>00683          <span class="keywordflow">continue</span>;
<a name="l00684"></a>00684       }
<a name="l00685"></a>00685       scr &gt;&gt; word;
<a name="l00686"></a>00686       <span class="keywordflow">if</span> (word == <span class="stringliteral">&quot;window&quot;</span>)
<a name="l00687"></a>00687       {
<a name="l00688"></a>00688          scr &gt;&gt; <a class="code" href="glvis_8cpp.html#a9ce11c4941669bb54ef502b68af07ec4">window_x</a> &gt;&gt; <a class="code" href="glvis_8cpp.html#a62627cc91e2bb07cf1033188a9863bfc">window_y</a> &gt;&gt; <a class="code" href="glvis_8cpp.html#a59f74fee0c8a623650109c9fb35d4fae">window_w</a> &gt;&gt; <a class="code" href="glvis_8cpp.html#a7b6ea03893fc7fb4126a3a0c2fb0c319">window_h</a>;
<a name="l00689"></a>00689       }
<a name="l00690"></a>00690       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (word == <span class="stringliteral">&quot;solution&quot;</span>)
<a name="l00691"></a>00691       {
<a name="l00692"></a>00692          <span class="keywordflow">if</span> (<a class="code" href="glvis_8cpp.html#a7338b117485f5eb4d304888a33049e31">ScriptReadSolution</a>(scr, &amp;<a class="code" href="glvis_8cpp.html#a6e08f89b32254fb4b129720418e7c6ea">mesh</a>, &amp;<a class="code" href="glvis_8cpp.html#a25f770a09ffb9eedb1bd5cea6429b871">grid_f</a>))
<a name="l00693"></a>00693             <span class="keywordflow">return</span>;
<a name="l00694"></a>00694 
<a name="l00695"></a>00695          <span class="comment">// start the visualization</span>
<a name="l00696"></a>00696          <span class="keywordflow">break</span>;
<a name="l00697"></a>00697       }
<a name="l00698"></a>00698       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (word == <span class="stringliteral">&quot;mesh&quot;</span>)
<a name="l00699"></a>00699       {
<a name="l00700"></a>00700          <span class="keywordflow">if</span> (<a class="code" href="glvis_8cpp.html#a882a2a898bd3baae6acdc76051c56227">ScriptReadDisplMesh</a>(scr, &amp;<a class="code" href="glvis_8cpp.html#a6e08f89b32254fb4b129720418e7c6ea">mesh</a>, &amp;<a class="code" href="glvis_8cpp.html#a25f770a09ffb9eedb1bd5cea6429b871">grid_f</a>))
<a name="l00701"></a>00701             <span class="keywordflow">return</span>;
<a name="l00702"></a>00702          <span class="keywordflow">if</span> (<a class="code" href="glvis_8cpp.html#a6e08f89b32254fb4b129720418e7c6ea">mesh</a>)
<a name="l00703"></a>00703             <span class="keywordflow">break</span>;
<a name="l00704"></a>00704       }
<a name="l00705"></a>00705       <span class="keywordflow">else</span>
<a name="l00706"></a>00706       {
<a name="l00707"></a>00707          cout &lt;&lt; <span class="stringliteral">&quot;Unknown command in script: &quot;</span> &lt;&lt; word &lt;&lt; endl;
<a name="l00708"></a>00708       }
<a name="l00709"></a>00709    }
<a name="l00710"></a>00710 
<a name="l00711"></a>00711    <span class="keywordtype">int</span> window_err;
<a name="l00712"></a>00712    <span class="keywordflow">if</span> (<a class="code" href="glvis_8cpp.html#a25f770a09ffb9eedb1bd5cea6429b871">grid_f</a>-&gt;VectorDim() == 1)
<a name="l00713"></a>00713       window_err = <a class="code" href="glvis_8cpp.html#ab318e333a53a4c136b8008ebf482b8b8">InitVis</a>(0);
<a name="l00714"></a>00714    <span class="keywordflow">else</span>
<a name="l00715"></a>00715       window_err = <a class="code" href="glvis_8cpp.html#ab318e333a53a4c136b8008ebf482b8b8">InitVis</a>(1);
<a name="l00716"></a>00716    <span class="keywordflow">if</span> (window_err)
<a name="l00717"></a>00717    {
<a name="l00718"></a>00718       cerr &lt;&lt; <span class="stringliteral">&quot;Initializing the visualization failed.&quot;</span> &lt;&lt; endl;
<a name="l00719"></a>00719       <span class="keywordflow">return</span>;
<a name="l00720"></a>00720    }
<a name="l00721"></a>00721 
<a name="l00722"></a>00722    <span class="keywordflow">if</span> (<a class="code" href="glvis_8cpp.html#a6e08f89b32254fb4b129720418e7c6ea">mesh</a>-&gt;Dimension() == 2)
<a name="l00723"></a>00723    {
<a name="l00724"></a>00724       <span class="keywordflow">if</span> (<a class="code" href="glvis_8cpp.html#a25f770a09ffb9eedb1bd5cea6429b871">grid_f</a>-&gt;VectorDim() == 1)
<a name="l00725"></a>00725       {
<a name="l00726"></a>00726          <a class="code" href="glvis_8cpp.html#a25f770a09ffb9eedb1bd5cea6429b871">grid_f</a>-&gt;GetNodalValues(<a class="code" href="glvis_8cpp.html#abdff2ecf770abe7e9e10d3ac91efecc2">sol</a>);
<a name="l00727"></a>00727          <a class="code" href="classVisualizationSceneSolution.html">VisualizationSceneSolution</a> *vss;
<a name="l00728"></a>00728          vs = vss = <span class="keyword">new</span> <a class="code" href="classVisualizationSceneSolution.html">VisualizationSceneSolution</a>(*<a class="code" href="glvis_8cpp.html#a6e08f89b32254fb4b129720418e7c6ea">mesh</a>, <a class="code" href="glvis_8cpp.html#abdff2ecf770abe7e9e10d3ac91efecc2">sol</a>);
<a name="l00729"></a>00729          vss-&gt;<a class="code" href="classVisualizationSceneSolution.html#a7394d70733dbaf5f0666a21e27cfd1a4">SetGridFunction</a>(*<a class="code" href="glvis_8cpp.html#a25f770a09ffb9eedb1bd5cea6429b871">grid_f</a>);
<a name="l00730"></a>00730       }
<a name="l00731"></a>00731       <span class="keywordflow">else</span>
<a name="l00732"></a>00732       {
<a name="l00733"></a>00733          vs = <span class="keyword">new</span> <a class="code" href="classVisualizationSceneVector.html">VisualizationSceneVector</a>(*<a class="code" href="glvis_8cpp.html#a25f770a09ffb9eedb1bd5cea6429b871">grid_f</a>);
<a name="l00734"></a>00734       }
<a name="l00735"></a>00735    }
<a name="l00736"></a>00736    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="glvis_8cpp.html#a6e08f89b32254fb4b129720418e7c6ea">mesh</a>-&gt;Dimension() == 3)
<a name="l00737"></a>00737    {
<a name="l00738"></a>00738       <span class="keywordflow">if</span> (<a class="code" href="glvis_8cpp.html#a25f770a09ffb9eedb1bd5cea6429b871">grid_f</a>-&gt;VectorDim() == 1)
<a name="l00739"></a>00739       {
<a name="l00740"></a>00740          <a class="code" href="glvis_8cpp.html#a25f770a09ffb9eedb1bd5cea6429b871">grid_f</a>-&gt;GetNodalValues(<a class="code" href="glvis_8cpp.html#abdff2ecf770abe7e9e10d3ac91efecc2">sol</a>);
<a name="l00741"></a>00741          <a class="code" href="classVisualizationSceneSolution3d.html">VisualizationSceneSolution3d</a> *vss;
<a name="l00742"></a>00742          vs = vss = <span class="keyword">new</span> <a class="code" href="classVisualizationSceneSolution3d.html">VisualizationSceneSolution3d</a>(*<a class="code" href="glvis_8cpp.html#a6e08f89b32254fb4b129720418e7c6ea">mesh</a>, <a class="code" href="glvis_8cpp.html#abdff2ecf770abe7e9e10d3ac91efecc2">sol</a>);
<a name="l00743"></a>00743          vss-&gt;<a class="code" href="classVisualizationSceneSolution3d.html#a036290b8240d8850695b297d823a591f">SetGridFunction</a>(<a class="code" href="glvis_8cpp.html#a25f770a09ffb9eedb1bd5cea6429b871">grid_f</a>);
<a name="l00744"></a>00744       }
<a name="l00745"></a>00745       <span class="keywordflow">else</span>
<a name="l00746"></a>00746       {
<a name="l00747"></a>00747          <span class="comment">// ...</span>
<a name="l00748"></a>00748       }
<a name="l00749"></a>00749    }
<a name="l00750"></a>00750 
<a name="l00751"></a>00751    <a class="code" href="glvis_8cpp.html#abf425bbc686fbedef7e537b5a3743788">scr_level</a> = <a class="code" href="glvis_8cpp.html#ac9a204cfe1cf4cf44eb62b5833fb7a59">scr_running</a> = 0;
<a name="l00752"></a>00752    auxKeyFunc(XK_space, <a class="code" href="glvis_8cpp.html#a24d99f34f0427dd99ee37bc356e8973a">ScriptControl</a>);
<a name="l00753"></a>00753    <a class="code" href="glvis_8cpp.html#ac2e15ab8707cf0b5252fea4a2b413de5">script</a> = &amp;scr;
<a name="l00754"></a>00754    <a class="code" href="glvis_8cpp.html#abf425bbc686fbedef7e537b5a3743788">scr_level</a> = <a class="code" href="glvis_8cpp.html#ac9a204cfe1cf4cf44eb62b5833fb7a59">scr_running</a> = 0;
<a name="l00755"></a>00755 
<a name="l00756"></a>00756    <a class="code" href="aux__vis_8cpp.html#a123d870a20286e4b2092338cb960e782" title="Start the infinite visualization loop.">SetVisualizationScene</a> (vs, 3);
<a name="l00757"></a>00757    <a class="code" href="aux__vis_8cpp.html#a0b4b010980b49b61990ed57786b88092">KillVisualization</a>(); <span class="comment">// deletes vs</span>
<a name="l00758"></a>00758    vs = NULL;
<a name="l00759"></a>00759    <span class="keyword">delete</span> <a class="code" href="glvis_8cpp.html#a25f770a09ffb9eedb1bd5cea6429b871">grid_f</a>; <a class="code" href="glvis_8cpp.html#a25f770a09ffb9eedb1bd5cea6429b871">grid_f</a> = NULL;
<a name="l00760"></a>00760    <span class="keyword">delete</span> <a class="code" href="glvis_8cpp.html#a6e08f89b32254fb4b129720418e7c6ea">mesh</a>; <a class="code" href="glvis_8cpp.html#a6e08f89b32254fb4b129720418e7c6ea">mesh</a> = NULL;
<a name="l00761"></a>00761    <span class="keyword">delete</span> <a class="code" href="glvis_8cpp.html#a6541d4ec47f9c1b3cd475b2e1ed73262">init_nodes</a>; <a class="code" href="glvis_8cpp.html#a6541d4ec47f9c1b3cd475b2e1ed73262">init_nodes</a> = NULL;
<a name="l00762"></a>00762 
<a name="l00763"></a>00763    cout &lt;&lt; <span class="stringliteral">&quot;Script: min_val = &quot;</span> &lt;&lt; <a class="code" href="glvis_8cpp.html#a595e4cfb0d88ad5063879cfd71fee1d3">scr_min_val</a>
<a name="l00764"></a>00764         &lt;&lt; <span class="stringliteral">&quot;, max_val = &quot;</span> &lt;&lt; <a class="code" href="glvis_8cpp.html#af3b4b81d02c5ed6da83ef0f3a3c62669">scr_max_val</a> &lt;&lt; endl;
<a name="l00765"></a>00765 
<a name="l00766"></a>00766    <a class="code" href="glvis_8cpp.html#ac2e15ab8707cf0b5252fea4a2b413de5">script</a> = NULL;
<a name="l00767"></a>00767 }
<a name="l00768"></a>00768 
<a name="l00769"></a>00769 
<a name="l00770"></a><a class="code" href="glvis_8cpp.html#a0ddf1224851353fc92bfbff6f499fa97">00770</a> <span class="keywordtype">int</span> <a class="code" href="glvis_8cpp.html#a0ddf1224851353fc92bfbff6f499fa97">main</a> (<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> *argv[])
<a name="l00771"></a>00771 {
<a name="l00772"></a>00772    <span class="keywordtype">int</span> i, childPID;
<a name="l00773"></a>00773    <span class="keywordtype">int</span> multi_session = 1;
<a name="l00774"></a>00774    <span class="keywordtype">int</span> saved = 0;
<a name="l00775"></a>00775 
<a name="l00776"></a>00776    isockstream *in;
<a name="l00777"></a>00777    istringstream *iss = NULL;
<a name="l00778"></a>00778 
<a name="l00779"></a>00779    <span class="keywordtype">char</span> data_type[32];
<a name="l00780"></a>00780 
<a name="l00781"></a>00781    <span class="comment">// parse the program arguments</span>
<a name="l00782"></a>00782    <span class="keywordflow">if</span> (argc != 1)
<a name="l00783"></a>00783    {
<a name="l00784"></a>00784       <span class="keywordflow">for</span> (i = 1; i &lt; argc; i++)
<a name="l00785"></a>00785          <span class="keywordflow">if</span> (strcmp(<span class="stringliteral">&quot;-m&quot;</span>, argv[i])==0)
<a name="l00786"></a>00786             strcpy(<a class="code" href="glvis_8cpp.html#abea2b72c5af0af9d44259a6b5f0f168f">mesh_file</a>, argv[++i]),        <a class="code" href="glvis_8cpp.html#adfab4eebf850cff6c1c1c4b8aa408293">input</a> |= 2;
<a name="l00787"></a>00787          <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(<span class="stringliteral">&quot;-s&quot;</span>, argv[i])==0)
<a name="l00788"></a>00788             strcpy(<a class="code" href="glvis_8cpp.html#a8c44e7f0b97e72d22bb9ceb8dfa14a73">sol_file</a>, argv[++i]),         <a class="code" href="glvis_8cpp.html#adfab4eebf850cff6c1c1c4b8aa408293">input</a> |= 4;
<a name="l00789"></a>00789          <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(<span class="stringliteral">&quot;-v&quot;</span>, argv[i])==0)
<a name="l00790"></a>00790             strcpy(<a class="code" href="glvis_8cpp.html#a8c44e7f0b97e72d22bb9ceb8dfa14a73">sol_file</a>, argv[++i]),         <a class="code" href="glvis_8cpp.html#adfab4eebf850cff6c1c1c4b8aa408293">input</a> |= 8;
<a name="l00791"></a>00791          <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(<span class="stringliteral">&quot;-g&quot;</span>, argv[i])==0)
<a name="l00792"></a>00792             strcpy(<a class="code" href="glvis_8cpp.html#a8c44e7f0b97e72d22bb9ceb8dfa14a73">sol_file</a>, argv[++i]),         <a class="code" href="glvis_8cpp.html#a0714f6a875376bdae0e5afc025374521">is_gf</a> = 255;
<a name="l00793"></a>00793          <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(<span class="stringliteral">&quot;-par3d&quot;</span>, argv[i])==0)  <a class="code" href="glvis_8cpp.html#adfab4eebf850cff6c1c1c4b8aa408293">input</a> |= 128;
<a name="l00794"></a>00794          <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(<span class="stringliteral">&quot;-np&quot;</span>, argv[i])==0)
<a name="l00795"></a>00795             <a class="code" href="glvis_8cpp.html#a928495140935d9d6ce0a100550473140">np</a>  = atoi(argv[++i]),               <a class="code" href="glvis_8cpp.html#adfab4eebf850cff6c1c1c4b8aa408293">input</a> |= 256;
<a name="l00796"></a>00796          <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(<span class="stringliteral">&quot;-vpar3d&quot;</span>, argv[i])==0) <a class="code" href="glvis_8cpp.html#adfab4eebf850cff6c1c1c4b8aa408293">input</a> |= 512;
<a name="l00797"></a>00797          <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(<span class="stringliteral">&quot;-p&quot;</span>, argv[i])==0)
<a name="l00798"></a>00798             <a class="code" href="glvis_8cpp.html#a6a277a44276ae8eb3ddf57068db21ad4">portnum</a> = atoi(argv[++i]);
<a name="l00799"></a>00799          <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(<span class="stringliteral">&quot;-t&quot;</span>, argv[i])==0)
<a name="l00800"></a>00800             multi_session = 0;
<a name="l00801"></a>00801          <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(<span class="stringliteral">&quot;-k&quot;</span>, argv[i])==0)
<a name="l00802"></a>00802             strcpy(<a class="code" href="glvis_8cpp.html#a51ba742484f9bdff4502c62248f0ab5b">keys</a>, argv[++i]);
<a name="l00803"></a>00803          <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(<span class="stringliteral">&quot;-saved&quot;</span>, argv[i])==0)
<a name="l00804"></a>00804             saved = 1;
<a name="l00805"></a>00805          <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(<span class="stringliteral">&quot;-mac&quot;</span>, argv[i])==0)
<a name="l00806"></a>00806             <a class="code" href="glvis_8cpp.html#a4b2065dfde212b686b1f4b5c2e176aae">mac</a> = 1;
<a name="l00807"></a>00807          <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(<span class="stringliteral">&quot;-sc&quot;</span>, argv[i])==0)
<a name="l00808"></a>00808             <a class="code" href="glvis_8cpp.html#acff48e064c2a8bd9e14f5215c7af4042">save_coloring</a> = 1;
<a name="l00809"></a>00809          <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(<span class="stringliteral">&quot;-gc&quot;</span>, argv[i])==0)
<a name="l00810"></a>00810             <a class="code" href="glvis_8cpp.html#acdd941cdcf1e0ea2f8232cf335455427">gf_component</a> = atoi(argv[++i]);
<a name="l00811"></a>00811          <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(<span class="stringliteral">&quot;-run&quot;</span>, argv[i])==0 &amp;&amp; i == 1 &amp;&amp; argc == 3)
<a name="l00812"></a>00812          {
<a name="l00813"></a>00813             ifstream scr(argv[2]);
<a name="l00814"></a>00814             <span class="keywordflow">if</span> (!scr)
<a name="l00815"></a>00815             {
<a name="l00816"></a>00816                cout &lt;&lt; <span class="stringliteral">&quot;Can not open script: &quot;</span> &lt;&lt; argv[2] &lt;&lt; endl;
<a name="l00817"></a>00817                <span class="keywordflow">return</span> 1;
<a name="l00818"></a>00818             }
<a name="l00819"></a>00819             <a class="code" href="glvis_8cpp.html#a79ac0aed09c13aac298ae36c4bd303a0">PlayScript</a>(scr);
<a name="l00820"></a>00820             <span class="keywordflow">return</span> 0;
<a name="l00821"></a>00821          }
<a name="l00822"></a>00822          <span class="keywordflow">else</span> <span class="comment">// display help</span>
<a name="l00823"></a>00823             <a class="code" href="glvis_8cpp.html#adfab4eebf850cff6c1c1c4b8aa408293">input</a> |= 31415;
<a name="l00824"></a>00824    }
<a name="l00825"></a>00825 
<a name="l00826"></a>00826    <span class="keywordflow">if</span> (saved)
<a name="l00827"></a>00827    {
<a name="l00828"></a>00828       <span class="comment">// This is the child process after exec()</span>
<a name="l00829"></a>00829       ifstream ifs(argv[2]);
<a name="l00830"></a>00830       ifs &gt;&gt; data_type;
<a name="l00831"></a>00831       <a class="code" href="glvis_8cpp.html#af94f1bc876c02a9c075cd150a676fbd9">VisStream</a>(&amp;ifs, data_type);
<a name="l00832"></a>00832       ifs.close();
<a name="l00833"></a>00833       exit(0);
<a name="l00834"></a>00834    }
<a name="l00835"></a>00835 
<a name="l00836"></a>00836    cout &lt;&lt; endl
<a name="l00837"></a>00837         &lt;&lt; <span class="stringliteral">&quot;       _/_/_/  _/      _/      _/  _/&quot;</span>          &lt;&lt; endl
<a name="l00838"></a>00838         &lt;&lt; <span class="stringliteral">&quot;    _/        _/      _/      _/        _/_/_/&quot;</span> &lt;&lt; endl
<a name="l00839"></a>00839         &lt;&lt; <span class="stringliteral">&quot;   _/  _/_/  _/      _/      _/  _/  _/_/&quot;</span>      &lt;&lt; endl
<a name="l00840"></a>00840         &lt;&lt; <span class="stringliteral">&quot;  _/    _/  _/        _/  _/    _/      _/_/&quot;</span>   &lt;&lt; endl
<a name="l00841"></a>00841         &lt;&lt; <span class="stringliteral">&quot;   _/_/_/  _/_/_/_/    _/      _/  _/_/_/&quot;</span>      &lt;&lt; endl
<a name="l00842"></a>00842         &lt;&lt; endl ;
<a name="l00843"></a>00843 
<a name="l00844"></a>00844    <span class="comment">// get rid of zombies</span>
<a name="l00845"></a>00845    signal(SIGCHLD, SIG_IGN);
<a name="l00846"></a>00846 
<a name="l00847"></a>00847    <span class="comment">// print help for wrong input</span>
<a name="l00848"></a>00848    <span class="keywordflow">if</span> (<a class="code" href="glvis_8cpp.html#adfab4eebf850cff6c1c1c4b8aa408293">input</a> != 1  &amp;&amp; <a class="code" href="glvis_8cpp.html#adfab4eebf850cff6c1c1c4b8aa408293">input</a> != 3 &amp;&amp; <a class="code" href="glvis_8cpp.html#adfab4eebf850cff6c1c1c4b8aa408293">input</a> != 7 &amp;&amp; <a class="code" href="glvis_8cpp.html#adfab4eebf850cff6c1c1c4b8aa408293">input</a> != 11 &amp;&amp;
<a name="l00849"></a>00849        <a class="code" href="glvis_8cpp.html#adfab4eebf850cff6c1c1c4b8aa408293">input</a> != 391 &amp;&amp; <a class="code" href="glvis_8cpp.html#adfab4eebf850cff6c1c1c4b8aa408293">input</a> != 775)
<a name="l00850"></a>00850    {
<a name="l00851"></a>00851       cerr &lt;&lt; <span class="stringliteral">&quot;Usage:&quot;</span> &lt;&lt; endl
<a name="l00852"></a>00852            &lt;&lt; <span class="stringliteral">&quot;  glvis [-mac] [-t] [-p &lt;port_number&gt;] [-k keys]&quot;</span> &lt;&lt; endl
<a name="l00853"></a>00853            &lt;&lt; <span class="stringliteral">&quot;or&quot;</span> &lt;&lt; endl
<a name="l00854"></a>00854            &lt;&lt; <span class="stringliteral">&quot;  glvis -m &lt;mesh_file&gt; [-k keys] [-sc]\n&quot;</span>
<a name="l00855"></a>00855            &lt;&lt; <span class="stringliteral">&quot;or&quot;</span> &lt;&lt; endl
<a name="l00856"></a>00856            &lt;&lt; <span class="stringliteral">&quot;  glvis -m &lt;mesh_file&gt; -s &lt;scalar_solution_file&gt; [-k keys]\n&quot;</span>
<a name="l00857"></a>00857            &lt;&lt; <span class="stringliteral">&quot;or&quot;</span> &lt;&lt; endl
<a name="l00858"></a>00858            &lt;&lt; <span class="stringliteral">&quot;  glvis -m &lt;mesh_file&gt; -v &lt;vector_solution_file&gt; [-k keys]\n&quot;</span>
<a name="l00859"></a>00859            &lt;&lt; <span class="stringliteral">&quot;or&quot;</span> &lt;&lt; endl
<a name="l00860"></a>00860            &lt;&lt; <span class="stringliteral">&quot;  glvis -m &lt;mesh_file&gt; -g &lt;grid_function_solution_file&gt; [-gc &lt;component&gt;] [-k keys]\n&quot;</span>
<a name="l00861"></a>00861            &lt;&lt; <span class="stringliteral">&quot;or&quot;</span> &lt;&lt; endl
<a name="l00862"></a>00862            &lt;&lt; <span class="stringliteral">&quot;  glvis {-par3d|-vpar3d} -np &lt;#domains&gt; -m &lt;mesh_prefix&gt; -s &lt;solution_prefix&gt; [-k keys]&quot;</span> &lt;&lt; endl
<a name="l00863"></a>00863            &lt;&lt; <span class="stringliteral">&quot;or&quot;</span> &lt;&lt; endl
<a name="l00864"></a>00864            &lt;&lt; <span class="stringliteral">&quot;  glvis -saved &lt;glvis-saved-file&gt;&quot;</span> &lt;&lt; endl
<a name="l00865"></a>00865            &lt;&lt; <span class="stringliteral">&quot;or&quot;</span> &lt;&lt; endl
<a name="l00866"></a>00866            &lt;&lt; <span class="stringliteral">&quot;  glvis -run &lt;glvis-script&gt;&quot;</span> &lt;&lt; endl
<a name="l00867"></a>00867            &lt;&lt; endl;
<a name="l00868"></a>00868       exit(1);
<a name="l00869"></a>00869    }
<a name="l00870"></a>00870 
<a name="l00871"></a>00871    <span class="keywordtype">int</span> nprocessors = 1, currentprocessor = 0;
<a name="l00872"></a>00872 
<a name="l00873"></a>00873    <span class="comment">// server mode, read the mesh and the solution from a socket</span>
<a name="l00874"></a>00874    <span class="keywordflow">if</span> (<a class="code" href="glvis_8cpp.html#adfab4eebf850cff6c1c1c4b8aa408293">input</a> == 1)
<a name="l00875"></a>00875    {
<a name="l00876"></a>00876       in = <span class="keyword">new</span> isockstream(<a class="code" href="glvis_8cpp.html#a6a277a44276ae8eb3ddf57068db21ad4">portnum</a>);
<a name="l00877"></a>00877       <span class="keywordflow">if</span> (in-&gt;good())
<a name="l00878"></a>00878          cout &lt;&lt; <span class="stringliteral">&quot;Waiting for data on port &quot;</span>
<a name="l00879"></a>00879               &lt;&lt; <a class="code" href="glvis_8cpp.html#a6a277a44276ae8eb3ddf57068db21ad4">portnum</a> &lt;&lt; <span class="stringliteral">&quot; ...  &quot;</span> &lt;&lt; endl;
<a name="l00880"></a>00880       <span class="keywordflow">else</span>
<a name="l00881"></a>00881          <span class="keywordflow">return</span> 2;
<a name="l00882"></a>00882 
<a name="l00883"></a>00883       <span class="keywordflow">while</span> (1)
<a name="l00884"></a>00884       {
<a name="l00885"></a>00885          <span class="keywordflow">do</span>
<a name="l00886"></a>00886          {
<a name="l00887"></a>00887             in-&gt;receive(&amp;iss);
<a name="l00888"></a>00888          }
<a name="l00889"></a>00889          <span class="keywordflow">while</span>(!in-&gt;good());
<a name="l00890"></a>00890 
<a name="l00891"></a>00891          (*iss) &gt;&gt; setw(32) &gt;&gt; data_type;
<a name="l00892"></a>00892 
<a name="l00893"></a>00893          <span class="keywordflow">if</span> (<a class="code" href="glvis_8cpp.html#a4b2065dfde212b686b1f4b5c2e176aae">mac</a>)
<a name="l00894"></a>00894             <a class="code" href="glvis_8cpp.html#aa1b4446661b06b47fd9210f5c0790b6f">viscount</a>++;
<a name="l00895"></a>00895 
<a name="l00896"></a>00896          <span class="keywordtype">int</span> <a class="code" href="glvis_8cpp.html#a928495140935d9d6ce0a100550473140">np</a>;
<a name="l00897"></a>00897          <span class="keywordflow">if</span> (strcmp(data_type,<span class="stringliteral">&quot;fem3d_paragrid&quot;</span>) == 0)
<a name="l00898"></a>00898          {
<a name="l00899"></a>00899             np = 0;
<a name="l00900"></a>00900             <span class="keywordflow">do</span>
<a name="l00901"></a>00901             {
<a name="l00902"></a>00902                *iss &gt;&gt; nprocessors &gt;&gt; currentprocessor;
<a name="l00903"></a>00903                <span class="keywordflow">if</span> (np == 0)
<a name="l00904"></a>00904                {
<a name="l00905"></a>00905                   <span class="keywordflow">if</span> (<a class="code" href="glvis_8cpp.html#a6e08f89b32254fb4b129720418e7c6ea">mesh</a> != NULL)
<a name="l00906"></a>00906                      <span class="keyword">delete</span> <a class="code" href="glvis_8cpp.html#a6e08f89b32254fb4b129720418e7c6ea">mesh</a>;
<a name="l00907"></a>00907                   <a class="code" href="glvis_8cpp.html#a1014d99d63c917d8bc76907ed803be21">data</a>[0] = &amp;<a class="code" href="glvis_8cpp.html#abdff2ecf770abe7e9e10d3ac91efecc2">sol</a>;
<a name="l00908"></a>00908                   <a class="code" href="glvis_8cpp.html#a6e08f89b32254fb4b129720418e7c6ea">mesh</a> = <span class="keyword">new</span> Mesh(*iss, <a class="code" href="glvis_8cpp.html#a1014d99d63c917d8bc76907ed803be21">data</a>, nprocessors, currentprocessor);
<a name="l00909"></a>00909                }
<a name="l00910"></a>00910                <span class="keywordflow">else</span>
<a name="l00911"></a>00911                   <a class="code" href="glvis_8cpp.html#a6e08f89b32254fb4b129720418e7c6ea">mesh</a> -&gt; Load (*iss, <a class="code" href="glvis_8cpp.html#a1014d99d63c917d8bc76907ed803be21">data</a>, nprocessors, currentprocessor);
<a name="l00912"></a>00912 
<a name="l00913"></a>00913                <span class="keywordflow">if</span> (nprocessors - 1 == np)
<a name="l00914"></a>00914                   <span class="keywordflow">break</span>;
<a name="l00915"></a>00915 
<a name="l00916"></a>00916                in-&gt;receive(&amp;iss);
<a name="l00917"></a>00917                *iss &gt;&gt; data_type;
<a name="l00918"></a>00918                np++;
<a name="l00919"></a>00919             }
<a name="l00920"></a>00920             <span class="keywordflow">while</span> ( 1 );
<a name="l00921"></a>00921          }
<a name="l00922"></a>00922 
<a name="l00923"></a>00923          <span class="keywordflow">if</span> (strcmp(data_type,<span class="stringliteral">&quot;vfem3d_paragrid&quot;</span>) == 0)
<a name="l00924"></a>00924          {
<a name="l00925"></a>00925             np = 0;
<a name="l00926"></a>00926             <span class="keywordflow">do</span>
<a name="l00927"></a>00927             {
<a name="l00928"></a>00928                *iss &gt;&gt; nprocessors &gt;&gt; currentprocessor;
<a name="l00929"></a>00929                <span class="keywordflow">if</span> (np == 0)
<a name="l00930"></a>00930                {
<a name="l00931"></a>00931                   <span class="keywordflow">if</span> (<a class="code" href="glvis_8cpp.html#a6e08f89b32254fb4b129720418e7c6ea">mesh</a> != NULL)
<a name="l00932"></a>00932                      <span class="keyword">delete</span> <a class="code" href="glvis_8cpp.html#a6e08f89b32254fb4b129720418e7c6ea">mesh</a>;
<a name="l00933"></a>00933                   <a class="code" href="glvis_8cpp.html#a1014d99d63c917d8bc76907ed803be21">data</a>[0] = &amp;<a class="code" href="glvis_8cpp.html#ad5f3d37af3d7cf7c7bb37557d671277d">solu</a>;
<a name="l00934"></a>00934                   <a class="code" href="glvis_8cpp.html#a1014d99d63c917d8bc76907ed803be21">data</a>[1] = &amp;<a class="code" href="glvis_8cpp.html#a84f9b469e4c4f34f5ec4f988bf0462f6">solv</a>;
<a name="l00935"></a>00935                   <a class="code" href="glvis_8cpp.html#a1014d99d63c917d8bc76907ed803be21">data</a>[2] = &amp;<a class="code" href="glvis_8cpp.html#ad1c82108bcbb85f7ee42a74277a45f8f">solw</a>;
<a name="l00936"></a>00936                   <a class="code" href="glvis_8cpp.html#a6e08f89b32254fb4b129720418e7c6ea">mesh</a> = <span class="keyword">new</span> Mesh ( *iss, <a class="code" href="glvis_8cpp.html#a1014d99d63c917d8bc76907ed803be21">data</a>, nprocessors, currentprocessor);
<a name="l00937"></a>00937                }
<a name="l00938"></a>00938                <span class="keywordflow">else</span>
<a name="l00939"></a>00939                   <a class="code" href="glvis_8cpp.html#a6e08f89b32254fb4b129720418e7c6ea">mesh</a> -&gt; Load ( *iss, <a class="code" href="glvis_8cpp.html#a1014d99d63c917d8bc76907ed803be21">data</a>, nprocessors, currentprocessor);
<a name="l00940"></a>00940 
<a name="l00941"></a>00941                <span class="keywordflow">if</span> (nprocessors - 1 == np)
<a name="l00942"></a>00942                   <span class="keywordflow">break</span>;
<a name="l00943"></a>00943 
<a name="l00944"></a>00944                in-&gt;receive(&amp;iss);
<a name="l00945"></a>00945                *iss &gt;&gt; data_type;
<a name="l00946"></a>00946                np++;
<a name="l00947"></a>00947             }
<a name="l00948"></a>00948             <span class="keywordflow">while</span> ( 1 );
<a name="l00949"></a>00949          }
<a name="l00950"></a>00950 
<a name="l00951"></a>00951          <span class="keywordtype">char</span> tmp_file[50];
<a name="l00952"></a>00952          <span class="keywordflow">if</span> (multi_session)
<a name="l00953"></a>00953          {
<a name="l00954"></a>00954             <span class="keywordflow">if</span> (<a class="code" href="glvis_8cpp.html#a4b2065dfde212b686b1f4b5c2e176aae">mac</a>)
<a name="l00955"></a>00955             {
<a name="l00956"></a>00956                sprintf(tmp_file,<span class="stringliteral">&quot;glvis-saved.%04d&quot;</span>,<a class="code" href="glvis_8cpp.html#aa1b4446661b06b47fd9210f5c0790b6f">viscount</a>);
<a name="l00957"></a>00957                ofstream ofs(tmp_file);
<a name="l00958"></a>00958                ofs &lt;&lt; data_type &lt;&lt; <span class="charliteral">&#39;\n&#39;</span> &lt;&lt; iss -&gt; rdbuf();
<a name="l00959"></a>00959                ofs.close();
<a name="l00960"></a>00960                cout &lt;&lt; <span class="stringliteral">&quot;Data saved in &quot;</span> &lt;&lt; tmp_file &lt;&lt; endl;
<a name="l00961"></a>00961             }
<a name="l00962"></a>00962             childPID = fork();
<a name="l00963"></a>00963          }
<a name="l00964"></a>00964          <span class="keywordflow">else</span>
<a name="l00965"></a>00965          {
<a name="l00966"></a>00966             childPID = 0;
<a name="l00967"></a>00967          }
<a name="l00968"></a>00968 
<a name="l00969"></a>00969          <span class="keywordflow">switch</span> (childPID)
<a name="l00970"></a>00970          {
<a name="l00971"></a>00971          <span class="keywordflow">case</span> -1:
<a name="l00972"></a>00972             cout &lt;&lt; <span class="stringliteral">&quot;The process couldn&#39;t fork. Exit.&quot;</span> &lt;&lt; endl;
<a name="l00973"></a>00973             exit(1);
<a name="l00974"></a>00974 
<a name="l00975"></a>00975          <span class="keywordflow">case</span> 0:                       <span class="comment">// This is the child process</span>
<a name="l00976"></a>00976             <span class="keyword">delete</span> in;
<a name="l00977"></a>00977             <span class="keywordflow">if</span> (<a class="code" href="glvis_8cpp.html#a4b2065dfde212b686b1f4b5c2e176aae">mac</a>)
<a name="l00978"></a>00978             {
<a name="l00979"></a>00979                <span class="comment">// exec ourself</span>
<a name="l00980"></a>00980                <span class="keyword">const</span> <span class="keywordtype">char</span> *args[3] = { argv[0], <span class="stringliteral">&quot;-saved&quot;</span>, tmp_file };
<a name="l00981"></a>00981                execve(args[0], (<span class="keywordtype">char</span>* <span class="keyword">const</span>*)args, <a class="code" href="glvis_8cpp.html#aa006daaf11f1e2e45a6ababaf463212b">environ</a>);
<a name="l00982"></a>00982                exit(0);
<a name="l00983"></a>00983             }
<a name="l00984"></a>00984             <span class="keywordflow">else</span>
<a name="l00985"></a>00985             {
<a name="l00986"></a>00986                <span class="keywordflow">if</span> (multi_session)
<a name="l00987"></a>00987                   signal(SIGINT, SIG_IGN);
<a name="l00988"></a>00988                <a class="code" href="glvis_8cpp.html#af94f1bc876c02a9c075cd150a676fbd9">VisStream</a>(iss, data_type);
<a name="l00989"></a>00989                <span class="keyword">delete</span> iss;
<a name="l00990"></a>00990                exit(0);
<a name="l00991"></a>00991             }
<a name="l00992"></a>00992 
<a name="l00993"></a>00993          <span class="keywordflow">default</span> :                     <span class="comment">// This is the parent process</span>
<a name="l00994"></a>00994             <a class="code" href="glvis_8cpp.html#a1014d99d63c917d8bc76907ed803be21">data</a>[0] = <a class="code" href="glvis_8cpp.html#a1014d99d63c917d8bc76907ed803be21">data</a>[1] = <a class="code" href="glvis_8cpp.html#a1014d99d63c917d8bc76907ed803be21">data</a>[2] = NULL;
<a name="l00995"></a>00995          }
<a name="l00996"></a>00996       }
<a name="l00997"></a>00997 
<a name="l00998"></a>00998       <span class="comment">// delete in;</span>
<a name="l00999"></a>00999    }
<a name="l01000"></a>01000    <span class="keywordflow">else</span>
<a name="l01001"></a>01001    {
<a name="l01002"></a>01002       <span class="keywordflow">if</span> (<a class="code" href="glvis_8cpp.html#adfab4eebf850cff6c1c1c4b8aa408293">input</a> &amp; 256)
<a name="l01003"></a>01003          <a class="code" href="glvis_8cpp.html#ab6dbf6bd93cd8e385c10e3b8613a0685">ReadParallel</a>();
<a name="l01004"></a>01004       <span class="keywordflow">else</span>
<a name="l01005"></a>01005          <a class="code" href="glvis_8cpp.html#ae95873a146942467b3b5334fb87ae1c7">ReadSerial</a>();
<a name="l01006"></a>01006 
<a name="l01007"></a>01007       <span class="keywordtype">int</span> window_err;
<a name="l01008"></a>01008       <span class="keywordflow">if</span> (<a class="code" href="glvis_8cpp.html#a6e08f89b32254fb4b129720418e7c6ea">mesh</a>-&gt;Dimension() == 2)
<a name="l01009"></a>01009       {
<a name="l01010"></a>01010          <span class="keywordflow">if</span> ((<a class="code" href="glvis_8cpp.html#adfab4eebf850cff6c1c1c4b8aa408293">input</a> &amp; 8) == 0)
<a name="l01011"></a>01011          {
<a name="l01012"></a>01012             <a class="code" href="classVisualizationSceneSolution.html">VisualizationSceneSolution</a> *vss;
<a name="l01013"></a>01013             window_err = <a class="code" href="glvis_8cpp.html#ab318e333a53a4c136b8008ebf482b8b8">InitVis</a>(0);
<a name="l01014"></a>01014             <span class="keywordflow">if</span> (!window_err)
<a name="l01015"></a>01015             {
<a name="l01016"></a>01016                <span class="keywordflow">if</span> ((<a class="code" href="glvis_8cpp.html#adfab4eebf850cff6c1c1c4b8aa408293">input</a> &amp; 4) == 0)
<a name="l01017"></a>01017                   <a class="code" href="glvis_8cpp.html#a99a4b7a7c6575486b93f03efc4a0100a">Set_Palette</a>(4); <span class="comment">// Set_Palette(11);</span>
<a name="l01018"></a>01018                vs = vss = <span class="keyword">new</span> <a class="code" href="classVisualizationSceneSolution.html">VisualizationSceneSolution</a>(*<a class="code" href="glvis_8cpp.html#a6e08f89b32254fb4b129720418e7c6ea">mesh</a>, <a class="code" href="glvis_8cpp.html#abdff2ecf770abe7e9e10d3ac91efecc2">sol</a>);
<a name="l01019"></a>01019                <span class="keywordflow">if</span> (<a class="code" href="glvis_8cpp.html#a0714f6a875376bdae0e5afc025374521">is_gf</a>)
<a name="l01020"></a>01020                {
<a name="l01021"></a>01021                   vss-&gt;<a class="code" href="classVisualizationSceneSolution.html#a7394d70733dbaf5f0666a21e27cfd1a4">SetGridFunction</a>(*<a class="code" href="glvis_8cpp.html#a25f770a09ffb9eedb1bd5cea6429b871">grid_f</a>);
<a name="l01022"></a>01022                   vss-&gt;<a class="code" href="classVisualizationSceneSolution.html#ab89025477007d6ef8a50b1d883bfb8e1">ToggleShading</a>();
<a name="l01023"></a>01023                }
<a name="l01024"></a>01024                <span class="keywordflow">if</span> ((<a class="code" href="glvis_8cpp.html#adfab4eebf850cff6c1c1c4b8aa408293">input</a> &amp; 4) == 0)
<a name="l01025"></a>01025                {
<a name="l01026"></a>01026                   vs-&gt;<a class="code" href="classVisualizationScene.html#a260ebcb0c24e3883a7ce5d5daa1b5bff">OrthogonalProjection</a> = 1;
<a name="l01027"></a>01027                   vs-&gt;<a class="code" href="classVisualizationSceneScalarData.html#a3aa3bcd5e0788dced72f08724617687e">light</a> = 0;
<a name="l01028"></a>01028                   vs-&gt;<a class="code" href="classVisualizationScene.html#a8fae552e673d1855a23397c1582d7d4b">Zoom</a>(1.8);
<a name="l01029"></a>01029                   <span class="comment">// increase the refinement factors if the mesh is &quot;curved&quot;</span>
<a name="l01030"></a>01030                   <span class="keywordflow">if</span> (<a class="code" href="glvis_8cpp.html#a6e08f89b32254fb4b129720418e7c6ea">mesh</a>-&gt;GetNodalFESpace())
<a name="l01031"></a>01031                   {
<a name="l01032"></a>01032                      cout &lt;&lt; <span class="stringliteral">&quot;Curvilinear mesh, subdivision factors = 4, 1&quot;</span>
<a name="l01033"></a>01033                           &lt;&lt; endl;
<a name="l01034"></a>01034                      vs-&gt;<a class="code" href="classVisualizationSceneScalarData.html#a5091aaaead0699771bac466b2082943d">SetRefineFactors</a>(4, 1);
<a name="l01035"></a>01035                   }
<a name="l01036"></a>01036                   vs-&gt;<a class="code" href="classVisualizationSceneScalarData.html#a03d6de1181434b04da9183920a2eb232">SetValueRange</a>(-1.0*(<a class="code" href="glvis_8cpp.html#a25f770a09ffb9eedb1bd5cea6429b871">grid_f</a>-&gt;Max()+1.0),
<a name="l01037"></a>01037                                     1.0*(<a class="code" href="glvis_8cpp.html#a25f770a09ffb9eedb1bd5cea6429b871">grid_f</a>-&gt;Max()+1.0));
<a name="l01038"></a>01038                }
<a name="l01039"></a>01039             }
<a name="l01040"></a>01040          }
<a name="l01041"></a>01041          <span class="keywordflow">else</span>
<a name="l01042"></a>01042          {
<a name="l01043"></a>01043             window_err = <a class="code" href="glvis_8cpp.html#ab318e333a53a4c136b8008ebf482b8b8">InitVis</a>(1);
<a name="l01044"></a>01044             <span class="keywordflow">if</span> (!window_err)
<a name="l01045"></a>01045             {
<a name="l01046"></a>01046                <span class="keywordflow">if</span> (<a class="code" href="glvis_8cpp.html#a0714f6a875376bdae0e5afc025374521">is_gf</a>)
<a name="l01047"></a>01047                   vs = <span class="keyword">new</span> <a class="code" href="classVisualizationSceneVector.html">VisualizationSceneVector</a>(*<a class="code" href="glvis_8cpp.html#a25f770a09ffb9eedb1bd5cea6429b871">grid_f</a>);
<a name="l01048"></a>01048                <span class="keywordflow">else</span>
<a name="l01049"></a>01049                   vs = <span class="keyword">new</span> <a class="code" href="classVisualizationSceneVector.html">VisualizationSceneVector</a>(*<a class="code" href="glvis_8cpp.html#a6e08f89b32254fb4b129720418e7c6ea">mesh</a>, <a class="code" href="glvis_8cpp.html#ad5f3d37af3d7cf7c7bb37557d671277d">solu</a>, <a class="code" href="glvis_8cpp.html#a84f9b469e4c4f34f5ec4f988bf0462f6">solv</a>);
<a name="l01050"></a>01050             }
<a name="l01051"></a>01051          }
<a name="l01052"></a>01052       }
<a name="l01053"></a>01053       <span class="keywordflow">else</span> <span class="comment">// 3D</span>
<a name="l01054"></a>01054       {
<a name="l01055"></a>01055          <span class="keywordflow">if</span> ((<a class="code" href="glvis_8cpp.html#adfab4eebf850cff6c1c1c4b8aa408293">input</a> &amp; 8) == 0 &amp;&amp; (<a class="code" href="glvis_8cpp.html#adfab4eebf850cff6c1c1c4b8aa408293">input</a> &amp; 512) == 0)
<a name="l01056"></a>01056          {
<a name="l01057"></a>01057             <a class="code" href="classVisualizationSceneSolution3d.html">VisualizationSceneSolution3d</a> *vss;
<a name="l01058"></a>01058             window_err = <a class="code" href="glvis_8cpp.html#ab318e333a53a4c136b8008ebf482b8b8">InitVis</a>(0);
<a name="l01059"></a>01059             <span class="keywordflow">if</span> (!window_err)
<a name="l01060"></a>01060             {
<a name="l01061"></a>01061                vs = vss = <span class="keyword">new</span> <a class="code" href="classVisualizationSceneSolution3d.html">VisualizationSceneSolution3d</a>(*<a class="code" href="glvis_8cpp.html#a6e08f89b32254fb4b129720418e7c6ea">mesh</a>, <a class="code" href="glvis_8cpp.html#abdff2ecf770abe7e9e10d3ac91efecc2">sol</a>);
<a name="l01062"></a>01062                <span class="keywordflow">if</span> (<a class="code" href="glvis_8cpp.html#a0714f6a875376bdae0e5afc025374521">is_gf</a>)
<a name="l01063"></a>01063                {
<a name="l01064"></a>01064                   vss-&gt;<a class="code" href="classVisualizationSceneSolution3d.html#a036290b8240d8850695b297d823a591f">SetGridFunction</a> (<a class="code" href="glvis_8cpp.html#a25f770a09ffb9eedb1bd5cea6429b871">grid_f</a>);
<a name="l01065"></a>01065                   vss-&gt;<a class="code" href="classVisualizationSceneSolution3d.html#a8a7edd3a1a653ddbf14dc68981378925">ToggleShading</a>();
<a name="l01066"></a>01066                   vss-&gt;<a class="code" href="classVisualizationSceneSolution3d.html#ac7d7f156c3e0a567ba90ad2e770f992a">Prepare</a>();
<a name="l01067"></a>01067                   <span class="comment">// vss -&gt; Draw(); // ???</span>
<a name="l01068"></a>01068                }
<a name="l01069"></a>01069                <span class="keywordflow">if</span> ((<a class="code" href="glvis_8cpp.html#adfab4eebf850cff6c1c1c4b8aa408293">input</a> &amp; 4) == 0)
<a name="l01070"></a>01070                {
<a name="l01071"></a>01071                   <span class="comment">// Set_Palette(4);</span>
<a name="l01072"></a>01072                   <a class="code" href="glvis_8cpp.html#a99a4b7a7c6575486b93f03efc4a0100a">Set_Palette</a>(11);
<a name="l01073"></a>01073                   <a class="code" href="material_8cpp.html#a0e5bdab6aeb0e24f8bdb8237c00f0034">Set_Material_And_Light</a>(4,3);
<a name="l01074"></a>01074                   vss-&gt;<a class="code" href="classVisualizationSceneScalarData.html#a769e062ae92aba2fee5e610a4b6dc978">ToggleDrawAxes</a>();
<a name="l01075"></a>01075                   vss-&gt;<a class="code" href="classVisualizationSceneSolution3d.html#a5f86f531e33a82f63d1469b08e93fe45">ToggleDrawMesh</a>();
<a name="l01076"></a>01076                   vs-&gt;<a class="code" href="classVisualizationSceneScalarData.html#a03d6de1181434b04da9183920a2eb232">SetValueRange</a>(-1.0*(<a class="code" href="glvis_8cpp.html#a25f770a09ffb9eedb1bd5cea6429b871">grid_f</a>-&gt;Max()+1.0),
<a name="l01077"></a>01077                                     1.0*(<a class="code" href="glvis_8cpp.html#a25f770a09ffb9eedb1bd5cea6429b871">grid_f</a>-&gt;Max()+1.0));
<a name="l01078"></a>01078                }
<a name="l01079"></a>01079             }
<a name="l01080"></a>01080          }
<a name="l01081"></a>01081          <span class="keywordflow">else</span>
<a name="l01082"></a>01082          {
<a name="l01083"></a>01083             window_err = <a class="code" href="glvis_8cpp.html#ab318e333a53a4c136b8008ebf482b8b8">InitVis</a>(1);
<a name="l01084"></a>01084             <span class="keywordflow">if</span> (!window_err)
<a name="l01085"></a>01085             {
<a name="l01086"></a>01086                <span class="keywordflow">if</span> (<a class="code" href="glvis_8cpp.html#a0714f6a875376bdae0e5afc025374521">is_gf</a>)
<a name="l01087"></a>01087                   vs = <span class="keyword">new</span> <a class="code" href="classVisualizationSceneVector3d.html">VisualizationSceneVector3d</a>(*<a class="code" href="glvis_8cpp.html#a25f770a09ffb9eedb1bd5cea6429b871">grid_f</a>);
<a name="l01088"></a>01088                <span class="keywordflow">else</span>
<a name="l01089"></a>01089                   vs = <span class="keyword">new</span> <a class="code" href="classVisualizationSceneVector3d.html">VisualizationSceneVector3d</a>(*<a class="code" href="glvis_8cpp.html#a6e08f89b32254fb4b129720418e7c6ea">mesh</a>, <a class="code" href="glvis_8cpp.html#ad5f3d37af3d7cf7c7bb37557d671277d">solu</a>, <a class="code" href="glvis_8cpp.html#a84f9b469e4c4f34f5ec4f988bf0462f6">solv</a>, <a class="code" href="glvis_8cpp.html#ad1c82108bcbb85f7ee42a74277a45f8f">solw</a>);
<a name="l01090"></a>01090             }
<a name="l01091"></a>01091          }
<a name="l01092"></a>01092       }
<a name="l01093"></a>01093       <span class="keywordflow">if</span> (!window_err)
<a name="l01094"></a>01094       {
<a name="l01095"></a>01095          <span class="keywordflow">if</span> (<a class="code" href="glvis_8cpp.html#a6e08f89b32254fb4b129720418e7c6ea">mesh</a>-&gt;Dimension() == 2 &amp;&amp; (<a class="code" href="glvis_8cpp.html#adfab4eebf850cff6c1c1c4b8aa408293">input</a> &amp; 12) == 0)
<a name="l01096"></a>01096             <a class="code" href="aux__vis_8cpp.html#a123d870a20286e4b2092338cb960e782" title="Start the infinite visualization loop.">SetVisualizationScene</a>(vs, 2, <a class="code" href="glvis_8cpp.html#a51ba742484f9bdff4502c62248f0ab5b">keys</a>);
<a name="l01097"></a>01097          <span class="keywordflow">else</span>
<a name="l01098"></a>01098             <a class="code" href="aux__vis_8cpp.html#a123d870a20286e4b2092338cb960e782" title="Start the infinite visualization loop.">SetVisualizationScene</a>(vs, 3, <a class="code" href="glvis_8cpp.html#a51ba742484f9bdff4502c62248f0ab5b">keys</a>);
<a name="l01099"></a>01099          <a class="code" href="aux__vis_8cpp.html#a0b4b010980b49b61990ed57786b88092">KillVisualization</a>(); <span class="comment">// deletes vs</span>
<a name="l01100"></a>01100          <span class="keywordflow">if</span> (<a class="code" href="glvis_8cpp.html#a0714f6a875376bdae0e5afc025374521">is_gf</a>)  <span class="keyword">delete</span> <a class="code" href="glvis_8cpp.html#a25f770a09ffb9eedb1bd5cea6429b871">grid_f</a>;
<a name="l01101"></a>01101          <span class="keyword">delete</span> <a class="code" href="glvis_8cpp.html#a6e08f89b32254fb4b129720418e7c6ea">mesh</a>;
<a name="l01102"></a>01102       }
<a name="l01103"></a>01103       <span class="keywordflow">else</span>
<a name="l01104"></a>01104       {
<a name="l01105"></a>01105          cerr &lt;&lt; <span class="stringliteral">&quot;Initializing the visualization failed.&quot;</span> &lt;&lt; endl;
<a name="l01106"></a>01106          <span class="keywordflow">return</span> 1;
<a name="l01107"></a>01107       }
<a name="l01108"></a>01108    }
<a name="l01109"></a>01109 
<a name="l01110"></a>01110    cout &lt;&lt; <span class="stringliteral">&quot;Thank you for using GLVis.&quot;</span> &lt;&lt; endl;
<a name="l01111"></a>01111 
<a name="l01112"></a>01112    <span class="keywordflow">return</span> 0;
<a name="l01113"></a>01113 }
<a name="l01114"></a>01114 
<a name="l01115"></a>01115 
<a name="l01116"></a><a class="code" href="glvis_8cpp.html#ae95873a146942467b3b5334fb87ae1c7">01116</a> <span class="keywordtype">void</span> <a class="code" href="glvis_8cpp.html#ae95873a146942467b3b5334fb87ae1c7">ReadSerial</a>()
<a name="l01117"></a>01117 {
<a name="l01118"></a>01118    ifstream solin;
<a name="l01119"></a>01119 
<a name="l01120"></a>01120    <span class="comment">// get the mesh from a file</span>
<a name="l01121"></a>01121    {
<a name="l01122"></a>01122       ifstream meshin(<a class="code" href="glvis_8cpp.html#abea2b72c5af0af9d44259a6b5f0f168f">mesh_file</a>);
<a name="l01123"></a>01123       <span class="keywordflow">if</span> (!meshin)
<a name="l01124"></a>01124       {
<a name="l01125"></a>01125          cerr &lt;&lt; <span class="stringliteral">&quot;Can not open mesh file &quot;</span> &lt;&lt; <a class="code" href="glvis_8cpp.html#abea2b72c5af0af9d44259a6b5f0f168f">mesh_file</a> &lt;&lt; <span class="stringliteral">&quot;. Exit. \n&quot;</span>;
<a name="l01126"></a>01126          exit(1);
<a name="l01127"></a>01127       }
<a name="l01128"></a>01128 
<a name="l01129"></a>01129       <span class="comment">// mesh = new Mesh(meshin, is_gf?1:0, 0);</span>
<a name="l01130"></a>01130       <a class="code" href="glvis_8cpp.html#a6e08f89b32254fb4b129720418e7c6ea">mesh</a> = <span class="keyword">new</span> Mesh(meshin, 1, 0);
<a name="l01131"></a>01131    }
<a name="l01132"></a>01132 
<a name="l01133"></a>01133    <span class="keywordflow">if</span> (<a class="code" href="glvis_8cpp.html#a0714f6a875376bdae0e5afc025374521">is_gf</a> || (<a class="code" href="glvis_8cpp.html#adfab4eebf850cff6c1c1c4b8aa408293">input</a> &amp; 4) || (<a class="code" href="glvis_8cpp.html#adfab4eebf850cff6c1c1c4b8aa408293">input</a> &amp; 8))
<a name="l01134"></a>01134    {
<a name="l01135"></a>01135       <span class="comment">// get the solution from file</span>
<a name="l01136"></a>01136       ifstream solin(<a class="code" href="glvis_8cpp.html#a8c44e7f0b97e72d22bb9ceb8dfa14a73">sol_file</a>);
<a name="l01137"></a>01137       <span class="keywordflow">if</span> (!solin)
<a name="l01138"></a>01138       {
<a name="l01139"></a>01139          cerr &lt;&lt; <span class="stringliteral">&quot;Can not open solution file &quot;</span> &lt;&lt; <a class="code" href="glvis_8cpp.html#a8c44e7f0b97e72d22bb9ceb8dfa14a73">sol_file</a> &lt;&lt; <span class="stringliteral">&quot;. Exit.\n&quot;</span>;
<a name="l01140"></a>01140          exit(1);
<a name="l01141"></a>01141       }
<a name="l01142"></a>01142       <span class="keywordflow">if</span> (<a class="code" href="glvis_8cpp.html#a0714f6a875376bdae0e5afc025374521">is_gf</a>)
<a name="l01143"></a>01143       {
<a name="l01144"></a>01144          <a class="code" href="glvis_8cpp.html#a25f770a09ffb9eedb1bd5cea6429b871">grid_f</a> = <span class="keyword">new</span> GridFunction(<a class="code" href="glvis_8cpp.html#a6e08f89b32254fb4b129720418e7c6ea">mesh</a>, solin);
<a name="l01145"></a>01145          <span class="keywordflow">if</span> (<a class="code" href="glvis_8cpp.html#acdd941cdcf1e0ea2f8232cf335455427">gf_component</a> != -1)
<a name="l01146"></a>01146          {
<a name="l01147"></a>01147             <span class="keywordflow">if</span> (gf_component &lt; 0 || gf_component &gt;= <a class="code" href="glvis_8cpp.html#a25f770a09ffb9eedb1bd5cea6429b871">grid_f</a>-&gt;VectorDim())
<a name="l01148"></a>01148             {
<a name="l01149"></a>01149                cerr &lt;&lt; <span class="stringliteral">&quot;Invalid component &quot;</span> &lt;&lt; <a class="code" href="glvis_8cpp.html#acdd941cdcf1e0ea2f8232cf335455427">gf_component</a> &lt;&lt; <span class="charliteral">&#39;.&#39;</span> &lt;&lt; endl;
<a name="l01150"></a>01150                exit(1);
<a name="l01151"></a>01151             }
<a name="l01152"></a>01152             FiniteElementSpace *ofes = <a class="code" href="glvis_8cpp.html#a25f770a09ffb9eedb1bd5cea6429b871">grid_f</a>-&gt;FESpace();
<a name="l01153"></a>01153             FiniteElementCollection *fec =
<a name="l01154"></a>01154                FiniteElementCollection::New(ofes-&gt;FEColl()-&gt;Name());
<a name="l01155"></a>01155             FiniteElementSpace *fes = <span class="keyword">new</span> FiniteElementSpace(<a class="code" href="glvis_8cpp.html#a6e08f89b32254fb4b129720418e7c6ea">mesh</a>, fec);
<a name="l01156"></a>01156             GridFunction *new_gf = <span class="keyword">new</span> GridFunction(fes);
<a name="l01157"></a>01157             new_gf-&gt;MakeOwner(fec);
<a name="l01158"></a>01158             <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; new_gf-&gt;Size(); i++)
<a name="l01159"></a>01159                (*new_gf)(i) = (*<a class="code" href="glvis_8cpp.html#a25f770a09ffb9eedb1bd5cea6429b871">grid_f</a>)(ofes-&gt;DofToVDof(i, <a class="code" href="glvis_8cpp.html#acdd941cdcf1e0ea2f8232cf335455427">gf_component</a>));
<a name="l01160"></a>01160             <span class="keyword">delete</span> <a class="code" href="glvis_8cpp.html#a25f770a09ffb9eedb1bd5cea6429b871">grid_f</a>;
<a name="l01161"></a>01161             <a class="code" href="glvis_8cpp.html#a25f770a09ffb9eedb1bd5cea6429b871">grid_f</a> = new_gf;
<a name="l01162"></a>01162          }
<a name="l01163"></a>01163          <span class="keywordflow">if</span> (<a class="code" href="glvis_8cpp.html#a25f770a09ffb9eedb1bd5cea6429b871">grid_f</a>-&gt;VectorDim() == 1)
<a name="l01164"></a>01164          {
<a name="l01165"></a>01165             <a class="code" href="glvis_8cpp.html#a25f770a09ffb9eedb1bd5cea6429b871">grid_f</a>-&gt;GetNodalValues(<a class="code" href="glvis_8cpp.html#abdff2ecf770abe7e9e10d3ac91efecc2">sol</a>);
<a name="l01166"></a>01166             <a class="code" href="glvis_8cpp.html#adfab4eebf850cff6c1c1c4b8aa408293">input</a> |= 4;
<a name="l01167"></a>01167          }
<a name="l01168"></a>01168          <span class="keywordflow">else</span>
<a name="l01169"></a>01169          {
<a name="l01170"></a>01170             <a class="code" href="glvis_8cpp.html#adfab4eebf850cff6c1c1c4b8aa408293">input</a> |= 8;
<a name="l01171"></a>01171          }
<a name="l01172"></a>01172       }
<a name="l01173"></a>01173       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="glvis_8cpp.html#adfab4eebf850cff6c1c1c4b8aa408293">input</a> &amp; 4)
<a name="l01174"></a>01174       {
<a name="l01175"></a>01175          <span class="comment">// get rid of NetGen&#39;s info line</span>
<a name="l01176"></a>01176          <span class="keywordtype">char</span> buff[128];
<a name="l01177"></a>01177          solin.getline(buff,128);
<a name="l01178"></a>01178          <a class="code" href="glvis_8cpp.html#abdff2ecf770abe7e9e10d3ac91efecc2">sol</a>.Load(solin, <a class="code" href="glvis_8cpp.html#a6e08f89b32254fb4b129720418e7c6ea">mesh</a>-&gt;GetNV());
<a name="l01179"></a>01179       }
<a name="l01180"></a>01180       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="glvis_8cpp.html#adfab4eebf850cff6c1c1c4b8aa408293">input</a> &amp; 8)
<a name="l01181"></a>01181       {
<a name="l01182"></a>01182          <a class="code" href="glvis_8cpp.html#ad5f3d37af3d7cf7c7bb37557d671277d">solu</a>.Load(solin, <a class="code" href="glvis_8cpp.html#a6e08f89b32254fb4b129720418e7c6ea">mesh</a>-&gt;GetNV());
<a name="l01183"></a>01183          <a class="code" href="glvis_8cpp.html#a84f9b469e4c4f34f5ec4f988bf0462f6">solv</a>.Load(solin, <a class="code" href="glvis_8cpp.html#a6e08f89b32254fb4b129720418e7c6ea">mesh</a>-&gt;GetNV());
<a name="l01184"></a>01184          <span class="keywordflow">if</span> (<a class="code" href="glvis_8cpp.html#a6e08f89b32254fb4b129720418e7c6ea">mesh</a>-&gt;Dimension() == 3)
<a name="l01185"></a>01185             <a class="code" href="glvis_8cpp.html#ad1c82108bcbb85f7ee42a74277a45f8f">solw</a>.Load(solin, <a class="code" href="glvis_8cpp.html#a6e08f89b32254fb4b129720418e7c6ea">mesh</a>-&gt;GetNV());
<a name="l01186"></a>01186       }
<a name="l01187"></a>01187    }
<a name="l01188"></a>01188    <span class="keywordflow">else</span>
<a name="l01189"></a>01189    {
<a name="l01190"></a>01190       <span class="keywordflow">if</span> (1) <span class="comment">// if not given one, use a checkerboard solution</span>
<a name="l01191"></a>01191       {
<a name="l01192"></a>01192          FiniteElementCollection *cfec;
<a name="l01193"></a>01193          <span class="keywordflow">if</span> (<a class="code" href="glvis_8cpp.html#a6e08f89b32254fb4b129720418e7c6ea">mesh</a>-&gt;Dimension() == 2)
<a name="l01194"></a>01194             cfec = <span class="keyword">new</span> Const2DFECollection;
<a name="l01195"></a>01195          <span class="keywordflow">else</span>
<a name="l01196"></a>01196             cfec = <span class="keyword">new</span> Const3DFECollection;
<a name="l01197"></a>01197          FiniteElementSpace *cfes = <span class="keyword">new</span> FiniteElementSpace(<a class="code" href="glvis_8cpp.html#a6e08f89b32254fb4b129720418e7c6ea">mesh</a>, cfec);
<a name="l01198"></a>01198          <a class="code" href="glvis_8cpp.html#a25f770a09ffb9eedb1bd5cea6429b871">grid_f</a> = <span class="keyword">new</span> GridFunction(cfes);
<a name="l01199"></a>01199          <a class="code" href="glvis_8cpp.html#a25f770a09ffb9eedb1bd5cea6429b871">grid_f</a>-&gt;MakeOwner(cfec);
<a name="l01200"></a>01200          {
<a name="l01201"></a>01201             Array&lt;int&gt; coloring;
<a name="l01202"></a>01202             srandom(time(0));
<a name="l01203"></a>01203             <span class="keywordtype">double</span> a = double(random()) / (double(RAND_MAX) + 1.);
<a name="l01204"></a>01204             <span class="keywordtype">int</span> el0 = (int)floor(a * <a class="code" href="glvis_8cpp.html#a6e08f89b32254fb4b129720418e7c6ea">mesh</a>-&gt;GetNE());
<a name="l01205"></a>01205             cout &lt;&lt; <span class="stringliteral">&quot;Generating coloring starting with element &quot;</span> &lt;&lt; el0+1
<a name="l01206"></a>01206                  &lt;&lt; <span class="stringliteral">&quot; / &quot;</span> &lt;&lt; <a class="code" href="glvis_8cpp.html#a6e08f89b32254fb4b129720418e7c6ea">mesh</a>-&gt;GetNE() &lt;&lt; endl;
<a name="l01207"></a>01207             <a class="code" href="glvis_8cpp.html#a6e08f89b32254fb4b129720418e7c6ea">mesh</a>-&gt;GetElementColoring(coloring, el0);
<a name="l01208"></a>01208             <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; coloring.Size(); i++)
<a name="l01209"></a>01209                (*<a class="code" href="glvis_8cpp.html#a25f770a09ffb9eedb1bd5cea6429b871">grid_f</a>)(i) = coloring[i];
<a name="l01210"></a>01210             cout &lt;&lt; <span class="stringliteral">&quot;Number of colors: &quot;</span> &lt;&lt; <a class="code" href="glvis_8cpp.html#a25f770a09ffb9eedb1bd5cea6429b871">grid_f</a>-&gt;Max() + 1 &lt;&lt; endl;
<a name="l01211"></a>01211          }
<a name="l01212"></a>01212          <a class="code" href="glvis_8cpp.html#a25f770a09ffb9eedb1bd5cea6429b871">grid_f</a>-&gt;GetNodalValues(<a class="code" href="glvis_8cpp.html#abdff2ecf770abe7e9e10d3ac91efecc2">sol</a>);
<a name="l01213"></a>01213          <a class="code" href="glvis_8cpp.html#a0714f6a875376bdae0e5afc025374521">is_gf</a> = 1;
<a name="l01214"></a>01214          <span class="keywordflow">if</span> (<a class="code" href="glvis_8cpp.html#acff48e064c2a8bd9e14f5215c7af4042">save_coloring</a>)
<a name="l01215"></a>01215          {
<a name="l01216"></a>01216             ofstream fgrid(<span class="stringliteral">&quot;GLVis_coloring.gf&quot;</span>);
<a name="l01217"></a>01217             cout &lt;&lt; <span class="stringliteral">&quot;Saving the coloring function -&gt; &quot;</span> &lt;&lt; flush;
<a name="l01218"></a>01218             <a class="code" href="glvis_8cpp.html#a25f770a09ffb9eedb1bd5cea6429b871">grid_f</a>-&gt;Save(fgrid);
<a name="l01219"></a>01219             cout &lt;&lt; <span class="stringliteral">&quot;done.&quot;</span> &lt;&lt; endl;
<a name="l01220"></a>01220          }
<a name="l01221"></a>01221       }
<a name="l01222"></a>01222       <span class="keywordflow">else</span> <span class="comment">// use a zero solution by default</span>
<a name="l01223"></a>01223       {
<a name="l01224"></a>01224          <a class="code" href="glvis_8cpp.html#abdff2ecf770abe7e9e10d3ac91efecc2">sol</a>.SetSize (<a class="code" href="glvis_8cpp.html#a6e08f89b32254fb4b129720418e7c6ea">mesh</a> -&gt; GetNV());
<a name="l01225"></a>01225          <a class="code" href="glvis_8cpp.html#abdff2ecf770abe7e9e10d3ac91efecc2">sol</a> = 0.0;
<a name="l01226"></a>01226       }
<a name="l01227"></a>01227    }
<a name="l01228"></a>01228 }
<a name="l01229"></a>01229 
<a name="l01230"></a>01230 
<a name="l01231"></a><a class="code" href="glvis_8cpp.html#ab6dbf6bd93cd8e385c10e3b8613a0685">01231</a> <span class="keywordtype">void</span> <a class="code" href="glvis_8cpp.html#ab6dbf6bd93cd8e385c10e3b8613a0685">ReadParallel</a>()
<a name="l01232"></a>01232 {
<a name="l01233"></a>01233    <span class="keywordtype">int</span> i;
<a name="l01234"></a>01234    <span class="keywordtype">char</span> fname[100];
<a name="l01235"></a>01235    istream ** parin = <span class="keyword">new</span> istream* [<a class="code" href="glvis_8cpp.html#a928495140935d9d6ce0a100550473140">np</a>];
<a name="l01236"></a>01236 
<a name="l01237"></a>01237    <span class="keywordtype">int</span> * dim = <span class="keyword">new</span> <span class="keywordtype">int</span>[<a class="code" href="glvis_8cpp.html#a928495140935d9d6ce0a100550473140">np</a>];
<a name="l01238"></a>01238    <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="glvis_8cpp.html#a928495140935d9d6ce0a100550473140">np</a>; i++)
<a name="l01239"></a>01239    {
<a name="l01240"></a>01240       sprintf(fname,<span class="stringliteral">&quot;%s_%d&quot;</span>,<a class="code" href="glvis_8cpp.html#abea2b72c5af0af9d44259a6b5f0f168f">mesh_file</a>,i);
<a name="l01241"></a>01241       parin[i] = <span class="keyword">new</span> ifstream(fname);
<a name="l01242"></a>01242       <span class="keywordflow">if</span> (!(*parin[i]))
<a name="l01243"></a>01243       {
<a name="l01244"></a>01244          cerr &lt;&lt; <span class="stringliteral">&quot;Can not open mesh file &quot;</span> &lt;&lt; fname &lt;&lt; <span class="stringliteral">&quot;. Exit. \n&quot;</span>;
<a name="l01245"></a>01245          exit(1);
<a name="l01246"></a>01246       }
<a name="l01247"></a>01247    }
<a name="l01248"></a>01248    <a class="code" href="glvis_8cpp.html#a6e08f89b32254fb4b129720418e7c6ea">mesh</a> = <span class="keyword">new</span> Mesh(parin,np,dim);
<a name="l01249"></a>01249    <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="glvis_8cpp.html#a928495140935d9d6ce0a100550473140">np</a>; i++) <span class="keyword">delete</span> parin[i];
<a name="l01250"></a>01250 
<a name="l01251"></a>01251    ofstream meshout(<span class="stringliteral">&quot;mesh.out&quot;</span>);
<a name="l01252"></a>01252    meshout.setf(ios::scientific);
<a name="l01253"></a>01253    meshout.precision(12);
<a name="l01254"></a>01254    <a class="code" href="glvis_8cpp.html#a6e08f89b32254fb4b129720418e7c6ea">mesh</a> -&gt; Print(meshout);
<a name="l01255"></a>01255 
<a name="l01256"></a>01256    <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="glvis_8cpp.html#a928495140935d9d6ce0a100550473140">np</a>; i++)
<a name="l01257"></a>01257    {
<a name="l01258"></a>01258       sprintf(fname,<span class="stringliteral">&quot;%s_%d&quot;</span>,<a class="code" href="glvis_8cpp.html#a8c44e7f0b97e72d22bb9ceb8dfa14a73">sol_file</a>,i);
<a name="l01259"></a>01259       parin[i] = <span class="keyword">new</span> ifstream(fname);
<a name="l01260"></a>01260       <span class="keywordflow">if</span> (!(*parin[i]))
<a name="l01261"></a>01261       {
<a name="l01262"></a>01262          cerr &lt;&lt; <span class="stringliteral">&quot;Can not open solution file &quot;</span> &lt;&lt; fname &lt;&lt; <span class="stringliteral">&quot;. Exit. \n&quot;</span>;
<a name="l01263"></a>01263          exit(1);
<a name="l01264"></a>01264       }
<a name="l01265"></a>01265    }
<a name="l01266"></a>01266 
<a name="l01267"></a>01267    <span class="keywordflow">if</span> (<a class="code" href="glvis_8cpp.html#adfab4eebf850cff6c1c1c4b8aa408293">input</a> &amp; 128)
<a name="l01268"></a>01268    {
<a name="l01269"></a>01269       <span class="comment">// get rid of NetGen&#39;s info line</span>
<a name="l01270"></a>01270       <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="glvis_8cpp.html#a928495140935d9d6ce0a100550473140">np</a>; i++)
<a name="l01271"></a>01271          parin[i] -&gt; getline(fname,128);
<a name="l01272"></a>01272       <a class="code" href="glvis_8cpp.html#abdff2ecf770abe7e9e10d3ac91efecc2">sol</a>.Load(parin,np,dim);
<a name="l01273"></a>01273    }
<a name="l01274"></a>01274    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="glvis_8cpp.html#adfab4eebf850cff6c1c1c4b8aa408293">input</a> &amp; 512)
<a name="l01275"></a>01275    {
<a name="l01276"></a>01276       <a class="code" href="glvis_8cpp.html#ad5f3d37af3d7cf7c7bb37557d671277d">solu</a>.Load(parin, np, dim);
<a name="l01277"></a>01277       <a class="code" href="glvis_8cpp.html#a84f9b469e4c4f34f5ec4f988bf0462f6">solv</a>.Load(parin, np, dim);
<a name="l01278"></a>01278       <a class="code" href="glvis_8cpp.html#ad1c82108bcbb85f7ee42a74277a45f8f">solw</a>.Load(parin, np, dim);
<a name="l01279"></a>01279    }
<a name="l01280"></a>01280 
<a name="l01281"></a>01281    <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="glvis_8cpp.html#a928495140935d9d6ce0a100550473140">np</a>; i++) <span class="keyword">delete</span> parin[i];
<a name="l01282"></a>01282    <span class="keyword">delete</span> [] parin;
<a name="l01283"></a>01283    <span class="keyword">delete</span> [] dim;
<a name="l01284"></a>01284 }
</pre></div></div>
</div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<hr class="footer"/><address class="footer"><small>Generated on Sun Apr 17 2011 15:52:23 for GLVis by&#160;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.4 </small></address>
</body>
</html>
